<!DOCTYPE HTML>
<html lang="CN">
<head>
    

<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta name="keywords" content="电商网站实战第十章：商品规格管理, 极客文库">
    <meta name="description" content="0.学习目标
了解商品规格数据结构设计思路
实现商品规格查询
了解SPU和SKU数据结构设计思路
实现商品查询
了解商品新增的页面实现
独立编写商品新增后台功能

1.商品规格数据结构乐优商城是一个全品类的电商网站，因此商品的种类繁多，每一">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>电商网站实战第十章：商品规格管理 | 极客文库-知识库</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/css/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>

</head>

<body>

<header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="container">
            <div class="nav-wrapper">
                <div class="brand-logo">
                    <a href="/" class="waves-effect waves-light">
                        
                        <img src="/medias/logo.png" class="logo-img hide-on-small-only">
                        
                        <span class="logo-span">极客文库-知识库</span>
                    </a>
                </div>
                <a href="#" data-activates="mobile-nav" class="button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>主页</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fa-tags"></i>
            
            <span>标签</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>分类</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>归档</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>关于</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/friends" class="waves-effect waves-light">
            
            <i class="fa fa-address-book"></i>
            
            <span>友链</span>
        </a>
    </li>
    
    <li>
        <a id="toggleSearch" class="waves-effect waves-light">
            <i id="searchIcon" class="mdi-action-search"></i>
        </a>
    </li>

</ul>

<div class="side-nav" id="mobile-nav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">极客文库-知识库</div>
        <div class="logo-desc">
            
            汇总计算机相关领域知识、文章及教程，认准域名：https://zhishi.jikewenku.com
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                主页
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-tags"></i>
                
                标签
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                分类
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                归档
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                关于
            </a>
        </li>
        
        <li>
            <a href="/friends" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-address-book"></i>
                
                友链
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/geekerstar" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>

    <div class="social-link"><a href="https://github.com/geekerstar" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
    <i class="fa fa-github"></i>
</a>
<a href="https://weibo.com/247507792" class="tooltipped" target="_blank" data-tooltip="微博联系我" data-position="top" data-delay="50">
    <i class="fa fa-weibo"></i>
</a>
<a href="#!" class="tooltipped" data-tooltip="QQ联系我: 247507792" data-position="top" data-delay="50">
    <i class="fa fa-qq"></i>
</a>

<a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
    <i class="fa fa-rss"></i>
</a>
</div>
</div>

            </div>
        </div>

        
        <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/geekerstar" class="github-corner tooltipped hide-on-med-and-down" target="_blank" data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewbox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/>
    </svg>
</a>
        
    </nav>
</header>





<div class="bg-cover post-cover" style="background-image: url('/medias/featureimages/6.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        电商网站实战第十章：商品规格管理
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1,
    #articleContent h2,
    #articleContent h3,
    #articleContent h4,
    #articleContent h5,
    #articleContent h6 {
        padding-top: 76px;
        margin-top: -76px;
    }

    #articleContent h1 {
        line-height: 3.5rem;
    }

    #articleContent h2 {
        line-height: 3.2rem;
    }

    #articleContent h3 {
        line-height: 2.8rem;
    }

    #articleContent h4 {
        line-height: 2.5rem;
    }

    #articleContent h5 {
        line-height: 2.2rem;
    }

    #articleContent h6 {
        line-height: 1.9rem;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }
</style>
<div class="row">
    <div class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            
            <div class="article-tag">
                
                <a href="/tags/项目实战/" target="_blank">
                    <span class="chip bg-color">项目实战</span>
                </a>
                
                <a href="/tags/微服务/" target="_blank">
                    <span class="chip bg-color">微服务</span>
                </a>
                
                <a href="/tags/电商网站/" target="_blank">
                    <span class="chip bg-color">电商网站</span>
                </a>
                
            </div>
            
            <div class="post-info">
                
                <span class="post-cate">
                    <i class="fa fa-bookmark fa-fw icon-category"></i>
                    
                    <a href="/categories/项目实战/" class="post-category" target="_blank">
                        项目实战
                    </a>
                    
                </span>
                

                <span class="post-date">
                    <i class="fa fa-clock-o fa-fw"></i>2018-11-12
                </span>
            </div>
        </div>
        <hr>
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="0-学习目标"><a href="#0-学习目标" class="headerlink" title="0.学习目标"></a>0.学习目标</h1><ul>
<li>了解商品规格数据结构设计思路</li>
<li>实现商品规格查询</li>
<li>了解SPU和SKU数据结构设计思路</li>
<li>实现商品查询</li>
<li>了解商品新增的页面实现</li>
<li>独立编写商品新增后台功能</li>
</ul>
<h1 id="1-商品规格数据结构"><a href="#1-商品规格数据结构" class="headerlink" title="1.商品规格数据结构"></a>1.商品规格数据结构</h1><p>乐优商城是一个全品类的电商网站，因此商品的种类繁多，每一件商品，其属性又有差别。为了更准确描述商品及细分差别，抽象出两个概念：SPU和SKU，了解一下：</p>
<h2 id="1-1-SPU和SKU"><a href="#1-1-SPU和SKU" class="headerlink" title="1.1.SPU和SKU"></a>1.1.SPU和SKU</h2><p>SPU：Standard Product Unit （标准产品单位） ，一组具有共同属性的商品集</p>
<p>SKU：Stock Keeping Unit（库存量单位），SPU商品集因具体特性不同而细分的每个商品</p>
<p>以图为例来看：</p>
<p><img src="/2018/11/12/ly10/1526085541996.png" alt="1526085541996"></p>
<ul>
<li>本页的 华为Mate10 就是一个商品集（SPU）</li>
<li>因为颜色、内存等不同，而细分出不同的Mate10，如亮黑色128G版。（SKU）</li>
</ul>
<p>可以看出：</p>
<ul>
<li>SPU是一个抽象的商品集概念，为了方便后台的管理。</li>
<li>SKU才是具体要销售的商品，每一个SKU的价格、库存可能会不一样，用户购买的是SKU而不是SPU</li>
</ul>
<h2 id="1-2-数据库设计分析"><a href="#1-2-数据库设计分析" class="headerlink" title="1.2.数据库设计分析"></a>1.2.数据库设计分析</h2><h3 id="1-2-1-思考并发现问题"><a href="#1-2-1-思考并发现问题" class="headerlink" title="1.2.1.思考并发现问题"></a>1.2.1.思考并发现问题</h3><p>弄清楚了SPU和SKU的概念区分，接下来我们一起思考一下该如何设计数据库表。</p>
<p>首先来看SPU，大家一起思考下SPU应该有哪些字段来描述？</p>
<pre><code>id:主键
title：标题
description：描述
specification：规格
packaging_list：包装
after_service：售后服务
comment：评价
category_id：商品分类
brand_id：品牌
</code></pre><p>似乎并不复杂，但是大家仔细思考一下，商品的规格字段你如何填写？</p>
<p> <img src="/2018/11/12/ly10/1526086539789.png" alt="1526086539789"></p>
<p>不同商品的规格不一定相同，数据库中要如何保存？</p>
<p>再看下SKU，大家觉得应该有什么字段？</p>
<pre><code>id：主键
spu_id：关联的spu
price：价格
images：图片
stock：库存
颜色？
内存？
硬盘？
</code></pre><p>碰到难题了，不同的商品分类，可能属性是不一样的，比如手机有内存，衣服有尺码，我们是全品类的电商网站，这些不同的商品的不同属性，如何设计到一张表中？</p>
<h3 id="1-2-2-分析规格参数"><a href="#1-2-2-分析规格参数" class="headerlink" title="1.2.2.分析规格参数"></a>1.2.2.分析规格参数</h3><p>仔细查看每一种商品的规格你会发现：</p>
<p>虽然商品规格千变万化，但是同一类商品（如手机）的规格是统一的，有图为证：</p>
<blockquote>
<p>华为的规格：</p>
</blockquote>
<p> <img src="/2018/11/12/ly10/1526087063700.png" alt="1526087063700"></p>
<blockquote>
<p>三星的规格：</p>
</blockquote>
<p> <img src="/2018/11/12/ly10/1526087142454.png" alt="1526087142454"></p>
<p>也就是说，商品的规格参数应该是与分类绑定的。<strong>每一个分类都有统一的规格参数模板，但不同商品其参数值可能不同</strong>。</p>
<p>如下图所示：</p>
<p> <img src="/2018/11/12/ly10/1526088168565.png" alt="1526088168565"></p>
<h3 id="1-2-3-SKU的特有属性"><a href="#1-2-3-SKU的特有属性" class="headerlink" title="1.2.3.SKU的特有属性"></a>1.2.3.SKU的特有属性</h3><p>SPU中会有一些特殊属性，用来区分不同的SKU，我们称为SKU特有属性。如华为META10的颜色、内存属性。</p>
<p>不同种类的商品，一个手机，一个衣服，其SKU属性不相同。</p>
<p>同一种类的商品，比如都是衣服，SKU属性基本是一样的，都是颜色、尺码等。</p>
<p>这样说起来，似乎SKU的特有属性也是与分类相关的？事实上，仔细观察你会发现，<strong>SKU的特有属性是商品规格参数的一部分</strong>：</p>
<p><img src="/2018/11/12/ly10/1526088981953.png" alt="1526088981953"></p>
<p>也就是说，我们没必要单独对SKU的特有属性进行设计，它可以看做是规格参数中的一部分。这样规格参数中的属性可以标记成两部分：</p>
<ul>
<li>所有sku共享的规格属性（称为全局属性）</li>
<li>每个sku不同的规格属性（称为特有属性）</li>
</ul>
<p><img src="/2018/11/12/ly10/1526089506566.png" alt="1526089506566"></p>
<h3 id="1-2-4-搜索属性"><a href="#1-2-4-搜索属性" class="headerlink" title="1.2.4.搜索属性"></a>1.2.4.搜索属性</h3><p>打开一个搜索页，我们来看看过滤的条件：</p>
<p><img src="/2018/11/12/ly10/1526090072535.png" alt="1526090072535"></p>
<p>你会发现，过滤条件中的屏幕尺寸、运行内存、网路、机身内存、电池容量、CPU核数等，在规格参数中都能找到：</p>
<p> <img src="/2018/11/12/ly10/1526090228171.png" alt="1526090228171"></p>
<p>也就是说，规格参数中的数据，将来会有一部分作为搜索条件来使用。我们可以在设计时，将这部分属性标记出来，将来做搜索的时候，作为过滤条件。要注意的是，无论是SPU的全局属性，还是SKU的特有属性，都有可能作为搜索过滤条件的，并不冲突，而是有一个交集：</p>
<p> <img src="/2018/11/12/ly10/1526091216124.png" alt="1526091216124"></p>
<h2 id="1-3-规格参数表"><a href="#1-3-规格参数表" class="headerlink" title="1.3.规格参数表"></a>1.3.规格参数表</h2><h3 id="1-3-1-表结构"><a href="#1-3-1-表结构" class="headerlink" title="1.3.1.表结构"></a>1.3.1.表结构</h3><p>先看下规格参数表：</p>
<pre class=" language-mysql"><code class="language-mysql">CREATE TABLE `tb_specification` (
  `category_id` bigint(20) NOT NULL COMMENT '规格模板所属商品分类id',
  `specifications` varchar(3000) NOT NULL DEFAULT '' COMMENT '规格参数模板，json格式',
  PRIMARY KEY (`category_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='商品规格参数模板，json格式。';
</code></pre>
<p>很奇怪是吧，只有两个字段。特别需要注意的是第二个字段：</p>
<ul>
<li>specificatons：规格参数模板，json格式</li>
</ul>
<p>为什么是一个json？我们看下规格参数的格式：</p>
<p><img src="/2018/11/12/ly10/1526092179381.png" alt="1526092179381"></p>
<p>如果按照传统数据库设计，这里至少需要3张表：</p>
<ul>
<li>group：代表组，与商品分类关联</li>
<li>param_key：属性名，与组关联，一对多</li>
<li>param_value：属性备选值，与属性名关联，一对多</li>
</ul>
<p>这样程序的复杂度大大增加，但是提高了数据的复用性。</p>
<p>我们的解决方案是，采用json来保存整个规格参数模板，不需要额外的表，一个字符串就够了。</p>
<h3 id="1-3-2-json结构分析"><a href="#1-3-2-json结构分析" class="headerlink" title="1.3.2.json结构分析"></a>1.3.2.json结构分析</h3><blockquote>
<p>先整体看一下：</p>
</blockquote>
<p> <img src="/2018/11/12/ly10/1526092693138.png" alt="1526092693138"></p>
<ul>
<li>因为规格参数分为很多组，所以json最外层是一个数组。</li>
<li>数组中是对象类型，每个对象代表一个组的数据，对象的属性包括：<ul>
<li>group：组的名称</li>
<li>params：该组的所有属性</li>
</ul>
</li>
</ul>
<blockquote>
<p>接下来是params：</p>
</blockquote>
<p> <img src="/2018/11/12/ly10/1526093111370.png" alt="1526093111370"></p>
<p>以<code>主芯片</code>这一组为例：</p>
<ul>
<li><p>group：注明，这里是主芯片</p>
</li>
<li><p>params：该组的所有规格属性，因为不止一个，所以是一个数组。这里包含四个规格属性：CPU品牌，CPU型号，CPU频率，CPU核数。每个规格属性都是一个对象，包含以下信息：</p>
<ul>
<li>k：属性名称</li>
<li>searchable：是否作为搜索字段，将来在搜索页面使用，boolean类型</li>
<li>global：是否是SPU全局属性，boolean类型。true为全局属性，false为SKU的特有属性</li>
<li>options：属性值的可选项，数组结构。起约束作用，不允许填写可选项以外的值，比如CPU核数，有人添10000核岂不是很扯淡</li>
<li>numerical：是否为数值，boolean类型，true则为数值，false则不是。为空也代表非数值</li>
<li>unit：单位，如：克，毫米。如果是数值类型，那么就需要有单位，否则可以不填。</li>
</ul>
</li>
</ul>
<p>上面的截图中所有属性都是全局属性，我们来看看内存，应该是特有属性：</p>
<p>  <img src="/2018/11/12/ly10/1526262641446.png" alt="1526262641446"></p>
<p>总结下：</p>
<ul>
<li>规格参数分组，每组有多个参数</li>
<li>参数的 <code>k</code>代表属性名称，没有值，具体的SPU才能确定值</li>
<li>参数会有不同的属性：是否可搜索，是否是全局、是否是数值，这些都用boolean值进行标记：<ul>
<li>SPU下的多个SKU共享的参数称为全局属性，用<code>global</code>标记</li>
<li>SPU下的多个SKU特有的参数称为特有属性</li>
<li>如果参数是数值类型，用<code>numerical</code>标记，并且指定单位<code>unit</code></li>
<li>如果参数可搜索，用<code>searchable</code>标记</li>
</ul>
</li>
</ul>
<h1 id="2-商品规格参数管理"><a href="#2-商品规格参数管理" class="headerlink" title="2.商品规格参数管理"></a>2.商品规格参数管理</h1><h2 id="2-1-页面实现"><a href="#2-1-页面实现" class="headerlink" title="2.1.页面实现"></a>2.1.页面实现</h2><p>页面比较复杂，这里就不带着大家去实现完整页面效果了，我们一起分析一下即可。</p>
<h3 id="2-1-1-整体布局"><a href="#2-1-1-整体布局" class="headerlink" title="2.1.1.整体布局"></a>2.1.1.整体布局</h3><p>打开规格参数页面，看到如下内容：</p>
<p><img src="/2018/11/12/ly10/1526095296462.png" alt="1526095296462"></p>
<p>因为规格是跟商品分类绑定的，因此首先会展现商品分类树，并且提示你要选择商品分类，才能看到规格参数的模板。一起了解下页面的实现：</p>
<p><img src="/2018/11/12/ly10/1526095548672.png" alt="1526095548672"></p>
<p>可以看出页面分成3个部分：</p>
<ul>
<li><p><code>v-card-title</code>：标题部分，这里是提示信息，告诉用户要先选择分类，才能看到模板</p>
</li>
<li><p><code>v-tree</code>：这里用到的是我们之前讲过的树组件，展示商品分类树，不过现在是假数据，我们只要把<code>treeData</code>属性删除，它就会走<code>url</code>属性指定的路径去查询真实的商品分类树了。</p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>v<span class="token operator">-</span>tree url<span class="token operator">=</span><span class="token string">"/item/category/list"</span> <span class="token punctuation">:</span>isEdit<span class="token operator">=</span><span class="token string">"false"</span>  @handleClick<span class="token operator">=</span><span class="token string">"handleClick"</span> <span class="token operator">/</span><span class="token operator">></span>
</code></pre>
</li>
<li><p><code>v-dialog</code>：Vuetify提供的对话框组件，v-model绑定的dialog属性是boolean类型：</p>
<ul>
<li>true则显示弹窗</li>
<li>false则隐藏弹窗</li>
</ul>
</li>
</ul>
<h3 id="2-1-2-data中定义的属性"><a href="#2-1-2-data中定义的属性" class="headerlink" title="2.1.2.data中定义的属性"></a>2.1.2.data中定义的属性</h3><p>接下来，看看Vue实例中data定义了哪些属性，对页面会产生怎样的影响：</p>
<p> <img src="/2018/11/12/ly10/1526287774316.png" alt="1526287774316"></p>
<ul>
<li>specifications：选中一个商品分类后，需要查询后台获取规格参数信息，保存在这个对象中，Vue会完成页面渲染。</li>
<li>oldSpec：当前页兼具了规格的增、改、查等功能，这个对象记录被修改前的规格参数，以防用户撤销修改，用来恢复数据。</li>
<li>dialog：是否显示对话框的标记。true则显示，false则不显示</li>
<li>currentNode：记录当前选中的商品分类节点</li>
<li>isInsert：判断接下来是新增还是修改</li>
</ul>
<h2 id="2-2-规格参数的查询"><a href="#2-2-规格参数的查询" class="headerlink" title="2.2.规格参数的查询"></a>2.2.规格参数的查询</h2><p>点击树节点后要显示规格参数，因此查询功能应该编写在点击事件中。</p>
<p>了解一下：</p>
<h3 id="2-2-1-树节点的点击事件"><a href="#2-2-1-树节点的点击事件" class="headerlink" title="2.2.1.树节点的点击事件"></a>2.2.1.树节点的点击事件</h3><p>当我们点击树节点时，要将<code>v-dialog</code>打开，因此必须绑定一个点击事件：</p>
<p> <img src="/2018/11/12/ly10/1526095959539.png" alt="1526095959539"></p>
<p>我们来看下<code>handleClick</code>方法：</p>
<pre class=" language-js"><code class="language-js"><span class="token function">handleClick</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 判断点击的节点是否是父节点（只有点击到叶子节点才会弹窗）</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>node<span class="token punctuation">.</span>isParent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 如果是叶子节点，那么就发起ajax请求，去后台查询商品规格数据。</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/item/spec/"</span> <span class="token operator">+</span> node<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resp <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 查询成功后，把响应结果赋值给specifications属性，Vue会进行自动渲染。</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>specifications <span class="token operator">=</span> resp<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 记录下此时的规格数据，当页面撤销修改时，用来恢复原始数据</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>oldSpec <span class="token operator">=</span> resp<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 打开弹窗</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>dialog <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 标记此时要进行修改操作</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>isInsert <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 如果没有查询成功，那么询问是否添加规格</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">'该分类还没有规格参数，是否添加?'</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// 如果要添加，则将specifications初始化为空</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>specifications <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                    group<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                    params<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token comment" spellcheck="true">// 打开弹窗</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>dialog <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token comment" spellcheck="true">// 标记为新增</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>isInsert <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>因此，我们接下来要做的事情，就是编写接口，实现规格参数的查询了。</p>
<h3 id="2-2-2-后端代码"><a href="#2-2-2-后端代码" class="headerlink" title="2.2.2.后端代码"></a>2.2.2.后端代码</h3><blockquote>
<p>实体类</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"tb_specification"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Specification</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token keyword">private</span> Long categoryId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> String specifications<span class="token punctuation">;</span>

    <span class="token keyword">public</span> Long <span class="token function">getCategoryId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> categoryId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCategoryId</span><span class="token punctuation">(</span>Long categoryId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>categoryId <span class="token operator">=</span> categoryId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">getSpecifications</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> specifications<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSpecifications</span><span class="token punctuation">(</span>String specifications<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>specifications <span class="token operator">=</span> specifications<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p>mapper</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SpecificationMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token operator">&lt;</span>Specification<span class="token operator">></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p>controller</p>
</blockquote>
<p>先分析下需要的东西，在页面的ajax请求中可以看出：</p>
<ul>
<li><p>请求方式：查询，肯定是get</p>
</li>
<li><p>请求路径：/spec/{cid} ，这里通过路径占位符传递商品分类的id</p>
</li>
<li><p>请求参数：商品分类id</p>
</li>
<li><p>返回结果：页面是直接把<code>resp.data</code>赋值给了specifications：</p>
<p><img src="/2018/11/12/ly10/1526104087329.png" alt="1526104087329"></p>
<p>那么我们返回的应该是规格参数的字符串</p>
</li>
</ul>
<p>代码：</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"spec"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpecificationController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> SpecificationService specificationService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"{id}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> ResponseEntity<span class="token operator">&lt;</span>String<span class="token operator">></span> <span class="token function">querySpecificationByCategoryId</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> Long id<span class="token punctuation">)</span><span class="token punctuation">{</span>
        Specification spec <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>specificationService<span class="token punctuation">.</span><span class="token function">queryById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>spec <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntity</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>HttpStatus<span class="token punctuation">.</span>NOT_FOUND<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> ResponseEntity<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>spec<span class="token punctuation">.</span><span class="token function">getSpecifications</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p>service:</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpecificationService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> SpecificationMapper specificationMapper<span class="token punctuation">;</span>

    <span class="token keyword">public</span> Specification <span class="token function">queryById</span><span class="token punctuation">(</span>Long id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>specificationMapper<span class="token punctuation">.</span><span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p>页面访问测试：</p>
</blockquote>
<p>目前，我们数据库只提供了3条规格参数信息：</p>
<p> <img src="/2018/11/12/ly10/1526104551227.png" alt="1526104551227"></p>
<p>我们访问：<a href="http://api.leyou.com/api/item/spec/76" target="_blank" rel="noopener">http://api.leyou.com/api/item/spec/76</a></p>
<p> <img src="/2018/11/12/ly10/1526104475036.png" alt="1526104475036"></p>
<p>然后在后台系统中测试：</p>
<p><img src="/2018/11/12/ly10/1526104599452.png" alt="1526104599452"></p>
<p>当我们点击一个还不存在的规格参数的商品分类：</p>
<p><img src="/2018/11/12/ly10/1526104769276.png" alt="1526104769276"></p>
<h2 id="2-3-增、删、改（作业）"><a href="#2-3-增、删、改（作业）" class="headerlink" title="2.3.增、删、改（作业）"></a>2.3.增、删、改（作业）</h2><p>增删改的作业就留给大家去完成了。页面中接口都已定义，你要做的就是实现后台接口。</p>
<h1 id="3-SPU和SKU数据结构"><a href="#3-SPU和SKU数据结构" class="headerlink" title="3.SPU和SKU数据结构"></a>3.SPU和SKU数据结构</h1><p>规格确定以后，就可以添加商品了,先看下数据库表</p>
<h2 id="3-1-SPU表"><a href="#3-1-SPU表" class="headerlink" title="3.1.SPU表"></a>3.1.SPU表</h2><h3 id="3-1-1-表结构"><a href="#3-1-1-表结构" class="headerlink" title="3.1.1.表结构"></a>3.1.1.表结构</h3><p>SPU表：</p>
<pre class=" language-mysql"><code class="language-mysql">CREATE TABLE `tb_spu` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'spu id',
  `title` varchar(255) NOT NULL DEFAULT '' COMMENT '标题',
  `sub_title` varchar(255) DEFAULT '' COMMENT '子标题',
  `cid1` bigint(20) NOT NULL COMMENT '1级类目id',
  `cid2` bigint(20) NOT NULL COMMENT '2级类目id',
  `cid3` bigint(20) NOT NULL COMMENT '3级类目id',
  `brand_id` bigint(20) NOT NULL COMMENT '商品所属品牌id',
  `saleable` tinyint(1) NOT NULL DEFAULT '1' COMMENT '是否上架，0下架，1上架',
  `valid` tinyint(1) NOT NULL DEFAULT '1' COMMENT '是否有效，0已删除，1有效',
  `create_time` datetime DEFAULT NULL COMMENT '添加时间',
  `last_update_time` datetime DEFAULT NULL COMMENT '最后修改时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=208 DEFAULT CHARSET=utf8 COMMENT='spu表，该表描述的是一个抽象的商品，比如 iphone8';
</code></pre>
<p>与我们前面分析的基本类似，但是似乎少了一些字段，比如商品描述。</p>
<p>我们做了表的垂直拆分，将SPU的详情放到了另一张表：tb_spu_detail</p>
<pre class=" language-mysql"><code class="language-mysql">CREATE TABLE `tb_spu_detail` (
  `spu_id` bigint(20) NOT NULL,
  `description` text COMMENT '商品描述信息',
  `specifications` varchar(3000) NOT NULL DEFAULT '' COMMENT '全部规格参数数据',
  `spec_template` varchar(1000) NOT NULL COMMENT '特有规格参数及可选值信息，json格式',
  `packing_list` varchar(1000) DEFAULT '' COMMENT '包装清单',
  `after_service` varchar(1000) DEFAULT '' COMMENT '售后服务',
  PRIMARY KEY (`spu_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

</code></pre>
<p>这张表中的数据都比较大，为了不影响主表的查询效率我们拆分出这张表。</p>
<p>需要注意的是这两个字段：specifications和spec_template。</p>
<h3 id="3-1-2-spu中的规格参数"><a href="#3-1-2-spu中的规格参数" class="headerlink" title="3.1.2.spu中的规格参数"></a>3.1.2.spu中的规格参数</h3><p>前面讲过规格参数与商品分类绑定，一个分类下的所有SPU具有类似的规格参数。SPU下的SKU可能会有不同的规格参数，因此我们计划是这样：</p>
<ul>
<li>SPU中保存全局的规格参数信息。</li>
<li>SKU中保存特有规格参数。</li>
</ul>
<p>以手机为例，品牌、操作系统等肯定是全局属性，内存、颜色等肯定是特有属性。</p>
<p>当你确定了一个SPU，比如小米的：红米4X</p>
<p>全局属性举例：</p>
<pre><code>品牌：小米
型号：红米4X
</code></pre><p>特有属性举例：</p>
<pre><code>颜色：[香槟金, 樱花粉, 磨砂黑]
内存：[2G, 3G]
机身存储：[16GB, 32GB]
</code></pre><p>来看下我们的 表如何存储这些信息：</p>
<h4 id="3-1-2-1-specifications字段"><a href="#3-1-2-1-specifications字段" class="headerlink" title="3.1.2.1.specifications字段"></a>3.1.2.1.specifications字段</h4><p>首先是specifications，其中保存全部规格参数信息，因此也是一个json格式：</p>
<blockquote>
<p>整体来看：</p>
</blockquote>
<p> <img src="/2018/11/12/ly10/1526262279963.png" alt="1526262279963"></p>
<p>整体看上去与规格参数表中的数据一样，也是一个数组，并且分组，每组下有多个参数</p>
<blockquote>
<p>展开一组来看</p>
</blockquote>
<p> <img src="/2018/11/12/ly10/1526262389233.png" alt="1526262389233"></p>
<p>可以看到，与规格参数表中的模板相比，最大的区别就是，这里指定了具体的值，因为商品确定了，其参数值肯定也确定了。</p>
<blockquote>
<p>特有属性</p>
</blockquote>
<p>刚才看到的是全局属性，那么特有属性在这个字段中如何存储呢？</p>
<p> <img src="/2018/11/12/ly10/1526263214087.png" alt="1526263214087"></p>
<p>我们发现特有属性也是有的，但是，注意看这里是不确定具体值的，因为特有属性只有在SKU中才能确定。这里只是保存了options，所有SKU属性的可选项。</p>
<p>在哪里会用到这个字段的值呢，商品详情页的规格参数信息中：</p>
<p> <img src="/2018/11/12/ly10/1526267700765.png" alt="1526267700765"></p>
<h4 id="3-1-2-2-spec-template字段"><a href="#3-1-2-2-spec-template字段" class="headerlink" title="3.1.2.2.spec_template字段"></a>3.1.2.2.spec_template字段</h4><p>既然specifications已经包含了所有的规格参数，那么为什么又多出了一个spec_template呢？</p>
<p>里面又有哪些内容呢？</p>
<p>来看数据格式：</p>
<p> <img src="/2018/11/12/ly10/1526267952827.png" alt="1526267952827"></p>
<p>可以看出，里面只保存了规格参数中的特有属性，而且格式进行了大大的简化，只有属性的key，和待选项。</p>
<p>为什么要冗余保存一份？</p>
<p>因为很多场景下我们只需要查询特有规格属性，如果放在一起，每次查询再去分离比较麻烦。</p>
<p>比如，商品详情页展示可选的规格参数时：</p>
<p>   <img src="/2018/11/12/ly10/1526267828817.png" alt="1526267828817"></p>
<h2 id="3-2-SKU表"><a href="#3-2-SKU表" class="headerlink" title="3.2.SKU表"></a>3.2.SKU表</h2><h3 id="3-2-1-表结构"><a href="#3-2-1-表结构" class="headerlink" title="3.2.1.表结构"></a>3.2.1.表结构</h3><pre class=" language-mysql"><code class="language-mysql">CREATE TABLE `tb_sku` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'sku id',
  `spu_id` bigint(20) NOT NULL COMMENT 'spu id',
  `title` varchar(255) NOT NULL COMMENT '商品标题',
  `images` varchar(1000) DEFAULT '' COMMENT '商品的图片，多个图片以‘,’分割',
  `price` bigint(15) NOT NULL DEFAULT '0' COMMENT '销售价格，单位为分',
  `indexes` varchar(100) COMMENT '特有规格属性在spu属性模板中的对应下标组合',
  `own_spec` varchar(1000) COMMENT 'sku的特有规格参数，json格式，反序列化时应使用linkedHashMap，保证有序',
  `enable` tinyint(1) NOT NULL DEFAULT '1' COMMENT '是否有效，0无效，1有效',
  `create_time` datetime NOT NULL COMMENT '添加时间',
  `last_update_time` datetime NOT NULL COMMENT '最后修改时间',
  PRIMARY KEY (`id`),
  KEY `key_spu_id` (`spu_id`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='sku表,该表表示具体的商品实体,如黑色的64GB的iphone 8';
</code></pre>
<p>还有一张表，代表库存：</p>
<pre class=" language-mysql"><code class="language-mysql">CREATE TABLE `tb_stock` (
  `sku_id` bigint(20) NOT NULL COMMENT '库存对应的商品sku id',
  `seckill_stock` int(9) DEFAULT '0' COMMENT '可秒杀库存',
  `seckill_total` int(9) DEFAULT '0' COMMENT '秒杀总数量',
  `stock` int(9) NOT NULL COMMENT '库存数量',
  PRIMARY KEY (`sku_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='库存表，代表库存，秒杀库存等信息';
</code></pre>
<p>问题：为什么要将库存独立一张表？</p>
<p>因为库存字段写频率较高，而SKU的其它字段以读为主，因此我们将两张表分离，读写不会干扰。</p>
<p>特别需要注意的是sku表中的<code>indexes</code>字段和<code>own_spec</code>字段。sku中应该保存特有规格参数的值，就在这两个字段中。</p>
<h3 id="3-2-2-sku中的特有规格参数"><a href="#3-2-2-sku中的特有规格参数" class="headerlink" title="3.2.2.sku中的特有规格参数"></a>3.2.2.sku中的特有规格参数</h3><h4 id="3-2-2-1-indexes字段"><a href="#3-2-2-1-indexes字段" class="headerlink" title="3.2.2.1.indexes字段"></a>3.2.2.1.indexes字段</h4><p>在SPU表中，已经对特有规格参数及可选项进行了保存，结构如下：</p>
<pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"机身颜色"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"香槟金"</span><span class="token punctuation">,</span>
        <span class="token string">"樱花粉"</span><span class="token punctuation">,</span>
        <span class="token string">"磨砂黑"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"内存"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"2GB"</span><span class="token punctuation">,</span>
        <span class="token string">"3GB"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"机身存储"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"16GB"</span><span class="token punctuation">,</span>
        <span class="token string">"32GB"</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<p>这些特有属性如果排列组合，会产生12个不同的SKU，而不同的SKU，其属性就是上面备选项中的一个。</p>
<p>比如：</p>
<ul>
<li>红米4X，香槟金，2GB内存，16GB存储</li>
<li>红米4X，磨砂黑，2GB内存，32GB存储</li>
</ul>
<p>你会发现，每一个属性值，对应于SPUoptions数组的一个选项，如果我们记录下角标，就是这样：</p>
<ul>
<li>红米4X，0,0,0</li>
<li>红米4X，2,0,1</li>
</ul>
<p>既然如此，我们是不是可以将不同角标串联起来，作为SPU下不同SKU的标示。这就是我们的indexes字段。</p>
<p> <img src="/2018/11/12/ly10/1526266901335.png" alt="1526266901335"></p>
<p>这个设计在商品详情页会特别有用：</p>
<p> <img src="/2018/11/12/ly10/1526267180997.png" alt="1526267180997"></p>
<p>当用户点击选中一个特有属性，你就能根据 角标快速定位到sku。</p>
<h4 id="3-2-2-2-own-spec字段"><a href="#3-2-2-2-own-spec字段" class="headerlink" title="3.2.2.2.own_spec字段"></a>3.2.2.2.own_spec字段</h4><p>看结构：</p>
<pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span><span class="token property">"机身颜色"</span><span class="token operator">:</span><span class="token string">"香槟金"</span><span class="token punctuation">,</span><span class="token property">"内存"</span><span class="token operator">:</span><span class="token string">"2GB"</span><span class="token punctuation">,</span><span class="token property">"机身存储"</span><span class="token operator">:</span><span class="token string">"16GB"</span><span class="token punctuation">}</span>
</code></pre>
<p>保存的是特有属性的键值对。</p>
<p>SPU中保存的是可选项，但不确定具体的值，而SKU中的保存的就是具体的键值对了。</p>
<p>这样，在页面展示规格参数信息时，就可以根据key来获取值，用于显示。</p>
<h2 id="3-3-导入图片信息"><a href="#3-3-导入图片信息" class="headerlink" title="3.3.导入图片信息"></a>3.3.导入图片信息</h2><p>现在商品表中虽然有数据，但是所有的图片信息都是无法访问的，我们需要把图片导入到虚拟机：</p>
<p>首先，把课前资料提供的数据上传到虚拟机下：<code>/leyou/static</code>目录：</p>
<p><img src="/2018/11/12/ly10/1527823423289.png" alt="1527823423289"></p>
<p>然后，使用命令解压缩：</p>
<pre class=" language-sh"><code class="language-sh">unzip images.zip
</code></pre>
<p>修改Nginx配置，使nginx反向代理这些图片地址：</p>
<pre class=" language-sh"><code class="language-sh">vim /opt/nginx/config/nginx.conf
</code></pre>
<p>修改成如下配置：</p>
<pre class=" language-nginx"><code class="language-nginx"><span class="token keyword">server</span> <span class="token punctuation">{</span>
    <span class="token keyword">listen</span>       <span class="token number">80</span><span class="token punctuation">;</span>
    <span class="token keyword">server_name</span>  image<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>com<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true"># 监听域名中带有group的，交给FastDFS模块处理</span>
    <span class="token keyword">location</span> <span class="token operator">~</span><span class="token operator">/</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">/</span> <span class="token punctuation">{</span>
        ngx_fastdfs_module<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true"># 将其它图片代理指向本地的/leyou/static目录</span>
    <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
        <span class="token keyword">root</span>   <span class="token operator">/</span>leyou<span class="token operator">/</span>static<span class="token operator">/</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">error_page</span>   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  <span class="token operator">/</span>50x<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
    <span class="token keyword">location</span> <span class="token operator">=</span> <span class="token operator">/</span>50x<span class="token punctuation">.</span>html <span class="token punctuation">{</span>
        <span class="token keyword">root</span>   html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<h1 id="4-商品查询"><a href="#4-商品查询" class="headerlink" title="4.商品查询"></a>4.商品查询</h1><h2 id="4-1-效果预览"><a href="#4-1-效果预览" class="headerlink" title="4.1.效果预览"></a>4.1.效果预览</h2><p>接下来，我们实现商品管理的页面，先看下我们要实现的效果：</p>
<p><img src="/2018/11/12/ly10/1526268595873.png" alt="1526268595873"></p>
<p>可以看出整体是一个table，然后有新增按钮。是不是跟昨天写品牌管理很像？</p>
<p>模板代码在分别在Goods.vue</p>
<p> <img src="/2018/11/12/ly10/1526269215532.png" alt="1526269215532"></p>
<h2 id="4-2-从0开始"><a href="#4-2-从0开始" class="headerlink" title="4.2.从0开始"></a>4.2.从0开始</h2><p>接下来，我们自己来实现一下，新建两个组件：MyGoods.vue和MyGoodsForm.vue</p>
<p> <img src="/2018/11/12/ly10/1526269362233.png" alt="1526269362233"></p>
<p>内容先随意：</p>
<pre class=" language-vue"><code class="language-vue"><template>
  <v-card>
      MyGoods
  </v-card>
</template>

<script>

  export default {
    name: "my-goods",
    data() {
      return {
      }
    }
  }
</script>

<style scoped>

</style>
</code></pre>
<p>然后修改menu.js,新建一个菜单：</p>
<p> <img src="/2018/11/12/ly10/1526269555118.png" alt="1526269555118"></p>
<p>修改router/index.js，添加一个路由：</p>
<p> <img src="/2018/11/12/ly10/1526269615639.png" alt="1526269615639"></p>
<p>预览一下：</p>
<p> <img src="/2018/11/12/ly10/1526269739468.png" alt="1526269739468"></p>
<h2 id="4-3-页面实现"><a href="#4-3-页面实现" class="headerlink" title="4.3.页面实现"></a>4.3.页面实现</h2><h3 id="4-3-1-页面基本表格"><a href="#4-3-1-页面基本表格" class="headerlink" title="4.3.1.页面基本表格"></a>4.3.1.页面基本表格</h3><p>商品列表页与品牌列表页几乎一样，我们可以直接去复制一份过来，然后进行一些修改。</p>
<p>首先，字段不一样，商品列表也展示的SPU信息，包含以下字段：</p>
<pre><code>id：
title：标题
cname：商品分类名称
bname：品牌名称
</code></pre><p>完整代码：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-card</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-card-title</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-btn</span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>addGoods<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>新增商品<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-btn</span><span class="token punctuation">></span></span>
      <span class="token comment" spellcheck="true">&lt;!--搜索框，与search属性关联--></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-spacer</span><span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-text-field</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>输入关键字搜索<span class="token punctuation">"</span></span> <span class="token attr-name">v-model.lazy</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">append-icon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">hide-details</span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-card-title</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-divider</span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-data-table</span>
      <span class="token attr-name">:headers</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>headers<span class="token punctuation">"</span></span>
      <span class="token attr-name">:items</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>goodsList<span class="token punctuation">"</span></span>
      <span class="token attr-name">:search</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span>
      <span class="token attr-name">:pagination.sync</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pagination<span class="token punctuation">"</span></span>
      <span class="token attr-name">:total-items</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>totalGoods<span class="token punctuation">"</span></span>
      <span class="token attr-name">:loading</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>loading<span class="token punctuation">"</span></span>
      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>elevation-1<span class="token punctuation">"</span></span>
    <span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>items<span class="token punctuation">"</span></span> <span class="token attr-name">slot-scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>props<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>{{ props.item.id }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text-xs-center<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ props.item.title }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text-xs-center<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{props.item.cname}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text-xs-center<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ props.item.bname }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>justify-center layout<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-btn</span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>editGoods(props.item)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>编辑<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-btn</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-btn</span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>warning<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>删除<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-btn</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-btn</span> <span class="token punctuation">></span></span>下架<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-btn</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-data-table</span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!--弹出的对话框--></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-dialog</span> <span class="token attr-name">max-width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>500<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>show<span class="token punctuation">"</span></span> <span class="token attr-name">persistent</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-card</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!--对话框的标题--></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-toolbar</span> <span class="token attr-name">dense</span> <span class="token attr-name">dark</span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-toolbar-title</span><span class="token punctuation">></span></span>{{isEdit ? '修改' : '新增'}}商品<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-toolbar-title</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-spacer</span><span class="token punctuation">/></span></span>
          <span class="token comment" spellcheck="true">&lt;!--关闭窗口的按钮--></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-btn</span> <span class="token attr-name">icon</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>closeWindow<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-icon</span><span class="token punctuation">></span></span>close<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-icon</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-btn</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-toolbar</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!--对话框的内容，表单--></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-card-text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>px-5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-goods-form</span> <span class="token attr-name">:oldGoods</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>oldGoods<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-card-text</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-card</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-dialog</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-card</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">
  <span class="token comment" spellcheck="true">// 导入自定义的表单组件</span>
  <span class="token keyword">import</span> MyGoodsForm <span class="token keyword">from</span> <span class="token string">'./MyGoodsForm'</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">"my-goods"</span><span class="token punctuation">,</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        search<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 搜索过滤字段</span>
        totalGoods<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 总条数</span>
        goodsList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 当前页品牌数据</span>
        loading<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 是否在加载中</span>
        pagination<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 分页信息</span>
        headers<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>text<span class="token punctuation">:</span> <span class="token string">'id'</span><span class="token punctuation">,</span> align<span class="token punctuation">:</span> <span class="token string">'center'</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token string">'id'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>text<span class="token punctuation">:</span> <span class="token string">'标题'</span><span class="token punctuation">,</span> align<span class="token punctuation">:</span> <span class="token string">'center'</span><span class="token punctuation">,</span> sortable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token string">'title'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>text<span class="token punctuation">:</span> <span class="token string">'商品分类'</span><span class="token punctuation">,</span> align<span class="token punctuation">:</span> <span class="token string">'center'</span><span class="token punctuation">,</span> sortable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token string">'cname'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>text<span class="token punctuation">:</span> <span class="token string">'品牌'</span><span class="token punctuation">,</span> align<span class="token punctuation">:</span> <span class="token string">'center'</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token string">'bname'</span><span class="token punctuation">,</span> sortable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>text<span class="token punctuation">:</span> <span class="token string">'操作'</span><span class="token punctuation">,</span> align<span class="token punctuation">:</span> <span class="token string">'center'</span><span class="token punctuation">,</span> sortable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        show<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">// 控制对话框的显示</span>
        oldGoods<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 即将被编辑的商品信息</span>
        isEdit<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 是否是编辑</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 渲染后执行</span>
      <span class="token comment" spellcheck="true">// 查询数据</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDataFromServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      pagination<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 监视pagination属性的变化</span>
        deep<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// deep为true，会监视pagination的属性及属性中的对象属性变化</span>
        <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment" spellcheck="true">// 变化后的回调函数，这里我们再次调用getDataFromServer即可</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDataFromServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      search<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 监视搜索字段</span>
        <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDataFromServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token function">getDataFromServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 从服务的加载数的方法。</span>
        <span class="token comment" spellcheck="true">// 发起请求</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/item/spu/page"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
          params<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            key<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>search<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 搜索条件</span>
            page<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pagination<span class="token punctuation">.</span>page<span class="token punctuation">,</span><span class="token comment" spellcheck="true">// 当前页</span>
            rows<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pagination<span class="token punctuation">.</span>rowsPerPage<span class="token punctuation">,</span><span class="token comment" spellcheck="true">// 每页大小</span>
            sortBy<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pagination<span class="token punctuation">.</span>sortBy<span class="token punctuation">,</span><span class="token comment" spellcheck="true">// 排序字段</span>
            desc<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pagination<span class="token punctuation">.</span>descending<span class="token comment" spellcheck="true">// 是否降序</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resp <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 这里使用箭头函数</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>goodsList <span class="token operator">=</span> resp<span class="token punctuation">.</span>data<span class="token punctuation">.</span>items<span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>totalGoods <span class="token operator">=</span> resp<span class="token punctuation">.</span>data<span class="token punctuation">.</span>total<span class="token punctuation">;</span>
          <span class="token comment" spellcheck="true">// 完成赋值后，把加载状态赋值为false</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">addGoods</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 修改标记</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isEdit <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 控制弹窗可见：</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>show <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 把oldBrand变为null</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>oldBrand <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">editGoods</span><span class="token punctuation">(</span>oldGoods<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 修改标记</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isEdit <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 控制弹窗可见：</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>show <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 获取要编辑的brand</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>oldGoods <span class="token operator">=</span> oldGoods<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">closeWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 重新加载数据</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDataFromServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 关闭窗口</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>show <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    components<span class="token punctuation">:</span><span class="token punctuation">{</span>
      MyGoodsForm
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">></span></span><span class="token style language-css">

</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>
</code></pre>
<p>主要的改动点：</p>
<ul>
<li><p>页面的<code>v-data-table</code>中的属性绑定修改。items指向goodsList，totalItems指向totalGoods</p>
</li>
<li><p>页面渲染的字段名修改：字段改成商品的SPU字段：id、title，cname(商品分类名称),bname（品牌名称）</p>
</li>
<li><p>data属性修改了以下属性：</p>
<ul>
<li>goodsList：当前页商品数据</li>
<li>totalGoods：商品总数</li>
<li>headers：头信息，需要修改头显示名称</li>
<li>oldGoods：准备要修改的商品</li>
</ul>
</li>
<li><p>加载数据的函数：getDataFromServer，请求的路径进行了修改，另外去除了跟排序相关的查询。SPU查询不排序</p>
</li>
<li><p>新增商品的事件函数：清除了一些数据查询接口，只保留弹窗</p>
</li>
</ul>
<p>查看效果：</p>
<p><img src="/2018/11/12/ly10/1526272476614.png" alt="1526272476614"></p>
<p>因为没有编写查询功能，表格一直处于loading状态。</p>
<p>接下来看弹窗：</p>
<p><img src="/2018/11/12/ly10/1526272537552.png" alt="1526272537552"></p>
<h3 id="4-3-2-上下架状态按钮"><a href="#4-3-2-上下架状态按钮" class="headerlink" title="4.3.2.上下架状态按钮"></a>4.3.2.上下架状态按钮</h3><p>另外，似乎页面少了对上下架商品的过滤，在原始效果图中是有的：</p>
<p> <img src="/2018/11/12/ly10/1526277614649.png" alt="1526277614649"></p>
<p>这在Vuetify中是一组按钮，我们查看帮助文档：</p>
<p> <img src="/2018/11/12/ly10/1526277713391.png" alt="1526277713391"></p>
<p>查看实例得到以下信息：</p>
<p><code>v-btn</code>：一个按钮</p>
<p><code>v-btn-toggle</code>：按钮组，内部可以有多个按钮，点击切换，有以下属性：</p>
<ul>
<li>multiple：是否支持多选，默认是false</li>
<li>value：选中的按钮的值，如果是多选，结果是一个数组；单选，结果是点击的v-btn中的value值，因此按钮组的每个btn都需要指定value属性</li>
</ul>
<p>改造页面：</p>
<p>首先在data中定义一个属性，记录按钮的值。</p>
<pre class=" language-js"><code class="language-js">filter<span class="token punctuation">:</span><span class="token punctuation">{</span>
    saleable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 上架还是下架</span>
    search<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 搜索过滤字段</span>
<span class="token punctuation">}</span>
</code></pre>
<p>这里我们的做法是定义一个filter属性，内部在定义search来关联过滤字段，saleable来关联上下架情况。</p>
<p>这样watch就必须监听filter，而不是只监听search了：</p>
<pre class=" language-js"><code class="language-js">filter<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">// 监视搜索字段</span>
  <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDataFromServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  deep<span class="token punctuation">:</span><span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre>
<p>另外，页面中与search有关的所有字段都需要修改成filter.search:</p>
<pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!--搜索框，与search属性关联--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-text-field</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>输入关键字搜索<span class="token punctuation">"</span></span> <span class="token attr-name">v-model.lazy</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>filter.search<span class="token punctuation">"</span></span> <span class="token attr-name">append-icon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">hide-details</span><span class="token punctuation">/></span></span>
</code></pre>
<p>然后，在页面中添加按钮组：</p>
<pre class=" language-html"><code class="language-html"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-flex</span> <span class="token attr-name">xs3</span><span class="token punctuation">></span></span>
     状态：
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-btn-toggle</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>filter.saleable<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-btn</span> <span class="token attr-name">flat</span><span class="token punctuation">></span></span>
             全部
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-btn</span><span class="token punctuation">></span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-btn</span> <span class="token attr-name">flat</span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
             上架
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-btn</span><span class="token punctuation">></span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-btn</span> <span class="token attr-name">flat</span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
             下架
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-btn</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-btn-toggle</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-flex</span><span class="token punctuation">></span></span>
</code></pre>
<p>最后，不要忘了在查询时，将saleable携带上：</p>
<pre class=" language-js"><code class="language-js"><span class="token function">getDataFromServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 从服务的加载数的方法。</span>
    <span class="token comment" spellcheck="true">// 发起请求</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/item/spu/page"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        params<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            key<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>filter<span class="token punctuation">.</span>search<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 搜索条件</span>
            saleable<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>filter<span class="token punctuation">.</span>saleable<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 上下架</span>
            page<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pagination<span class="token punctuation">.</span>page<span class="token punctuation">,</span><span class="token comment" spellcheck="true">// 当前页</span>
            rows<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pagination<span class="token punctuation">.</span>rowsPerPage<span class="token punctuation">,</span><span class="token comment" spellcheck="true">// 每页大小</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resp <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 这里使用箭头函数</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>goodsList <span class="token operator">=</span> resp<span class="token punctuation">.</span>data<span class="token punctuation">.</span>items<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>totalGoods <span class="token operator">=</span> resp<span class="token punctuation">.</span>data<span class="token punctuation">.</span>total<span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 完成赋值后，把加载状态赋值为false</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="4-4-后台提供接口"><a href="#4-4-后台提供接口" class="headerlink" title="4.4.后台提供接口"></a>4.4.后台提供接口</h2><p>页面已经准备好，接下来在后台提供分页查询SPU的功能：</p>
<h3 id="4-4-1-实体类"><a href="#4-4-1-实体类" class="headerlink" title="4.4.1.实体类"></a>4.4.1.实体类</h3><blockquote>
<p>SPU</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"tb_spu"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Spu</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> GenerationType<span class="token punctuation">.</span>IDENTITY<span class="token punctuation">)</span>
    <span class="token keyword">private</span> Long id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Long brandId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Long cid1<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 1级类目</span>
    <span class="token keyword">private</span> Long cid2<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 2级类目</span>
    <span class="token keyword">private</span> Long cid3<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 3级类目</span>
    <span class="token keyword">private</span> String title<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 标题</span>
    <span class="token keyword">private</span> String subTitle<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 子标题</span>
    <span class="token keyword">private</span> Boolean saleable<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 是否上架</span>
    <span class="token keyword">private</span> Boolean valid<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 是否有效，逻辑删除用</span>
    <span class="token keyword">private</span> Date createTime<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 创建时间</span>
    <span class="token keyword">private</span> Date lastUpdateTime<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 最后修改时间</span>
    <span class="token comment" spellcheck="true">// 省略getter和setter</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p>SPU详情</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"tb_spu_detail"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpuDetail</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token keyword">private</span> Long spuId<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 对应的SPU的id</span>
    <span class="token keyword">private</span> String description<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 商品描述</span>
    <span class="token keyword">private</span> String specTemplate<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 商品特殊规格的名称及可选值模板</span>
    <span class="token keyword">private</span> String specifications<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 商品的全局规格属性</span>
    <span class="token keyword">private</span> String packingList<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 包装清单</span>
    <span class="token keyword">private</span> String afterService<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 售后服务</span>
    <span class="token comment" spellcheck="true">// 省略getter和setter</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="4-4-2-controller"><a href="#4-4-2-controller" class="headerlink" title="4.4.2.controller"></a>4.4.2.controller</h3><p>先分析：</p>
<ul>
<li><p>请求方式：GET</p>
</li>
<li><p>请求路径：/spu/page</p>
</li>
<li><p>请求参数：</p>
<ul>
<li>page：当前页</li>
<li>rows：每页大小</li>
<li>key：过滤条件</li>
<li>saleable：上架或下架</li>
</ul>
</li>
<li><p>返回结果：商品SPU的分页信息。</p>
<ul>
<li><p>要注意，页面展示的是商品分类和品牌名称，而数据库中保存的是id，怎么办？</p>
<p>我们可以新建一个类，继承SPU，并且拓展cname和bname属性，写到<code>ly-item-interface</code></p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpuBo</span> <span class="token keyword">extends</span> <span class="token class-name">Spu</span> <span class="token punctuation">{</span>

    String cname<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 商品分类名称</span>

    String bname<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 品牌名称</span>

    <span class="token comment" spellcheck="true">// 略 。。</span>
<span class="token punctuation">}</span>
</code></pre>
</li>
</ul>
</li>
</ul>
<p>编写controller代码：</p>
<p>我们把与商品相关的一切业务接口都放到一起，起名为GoodsController，业务层也是这样</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GoodsController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> GoodsService goodsService<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 分页查询SPU
     * @param page
     * @param rows
     * @param key
     * @return
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/spu/page"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> ResponseEntity<span class="token operator">&lt;</span>PageResult<span class="token operator">&lt;</span>SpuBo<span class="token operator">>></span> <span class="token function">querySpuByPage</span><span class="token punctuation">(</span>
            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"page"</span><span class="token punctuation">,</span> defaultValue <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">)</span> Integer page<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"rows"</span><span class="token punctuation">,</span> defaultValue <span class="token operator">=</span> <span class="token string">"5"</span><span class="token punctuation">)</span> Integer rows<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"key"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> String key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 分页查询spu信息</span>
        PageResult<span class="token operator">&lt;</span>SpuBo<span class="token operator">></span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>goodsService<span class="token punctuation">.</span><span class="token function">querySpuByPageAndSort</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> rows<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> null <span class="token operator">||</span> result<span class="token punctuation">.</span><span class="token function">getItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntity</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>HttpStatus<span class="token punctuation">.</span>NOT_FOUND<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> ResponseEntity<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="4-4-3-service"><a href="#4-4-3-service" class="headerlink" title="4.4.3.service"></a>4.4.3.service</h3><p>所有商品相关的业务（包括SPU和SKU）放到一个业务下：GoodsService。</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GoodsService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> SpuMapper spuMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> CategoryService categoryService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> BrandMapper brandMapper<span class="token punctuation">;</span>

    <span class="token keyword">public</span> PageResult<span class="token operator">&lt;</span>SpuBo<span class="token operator">></span> <span class="token function">querySpuByPageAndSort</span><span class="token punctuation">(</span>Integer page<span class="token punctuation">,</span> Integer rows<span class="token punctuation">,</span> Boolean saleable<span class="token punctuation">,</span> String key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 1、查询SPU</span>
        <span class="token comment" spellcheck="true">// 分页,最多允许查100条</span>
        PageHelper<span class="token punctuation">.</span><span class="token function">startPage</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>rows<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 创建查询条件</span>
        Example example <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Example</span><span class="token punctuation">(</span>Spu<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Example<span class="token punctuation">.</span>Criteria criteria <span class="token operator">=</span> example<span class="token punctuation">.</span><span class="token function">createCriteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 是否过滤上下架</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>saleable <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            criteria<span class="token punctuation">.</span><span class="token function">orEqualTo</span><span class="token punctuation">(</span><span class="token string">"saleable"</span><span class="token punctuation">,</span> saleable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// 是否模糊查询</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            criteria<span class="token punctuation">.</span><span class="token function">andLike</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">,</span> <span class="token string">"%"</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">"%"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        Page<span class="token operator">&lt;</span>Spu<span class="token operator">></span> pageInfo <span class="token operator">=</span> <span class="token punctuation">(</span>Page<span class="token operator">&lt;</span>Spu<span class="token operator">></span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>spuMapper<span class="token punctuation">.</span><span class="token function">selectByExample</span><span class="token punctuation">(</span>example<span class="token punctuation">)</span><span class="token punctuation">;</span>

        List<span class="token operator">&lt;</span>SpuBo<span class="token operator">></span> list <span class="token operator">=</span> pageInfo<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>spu <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 2、把spu变为 spuBo</span>
            SpuBo spuBo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpuBo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 属性拷贝</span>
            BeanUtils<span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>spu<span class="token punctuation">,</span> spuBo<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">// 3、查询spu的商品分类名称,要查三级分类</span>
            List<span class="token operator">&lt;</span>String<span class="token operator">></span> names <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>categoryService<span class="token punctuation">.</span><span class="token function">queryNameByIds</span><span class="token punctuation">(</span>
                    Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>spu<span class="token punctuation">.</span><span class="token function">getCid1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> spu<span class="token punctuation">.</span><span class="token function">getCid2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> spu<span class="token punctuation">.</span><span class="token function">getCid3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 将分类名称拼接后存入</span>
            spuBo<span class="token punctuation">.</span><span class="token function">setCname</span><span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">// 4、查询spu的品牌名称</span>
            Brand brand <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>brandMapper<span class="token punctuation">.</span><span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span>spu<span class="token punctuation">.</span><span class="token function">getBrandId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            spuBo<span class="token punctuation">.</span><span class="token function">setBname</span><span class="token punctuation">(</span>brand<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> spuBo<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PageResult</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>pageInfo<span class="token punctuation">.</span><span class="token function">getTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="4-4-4-mapper"><a href="#4-4-4-mapper" class="headerlink" title="4.4.4.mapper"></a>4.4.4.mapper</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SpuMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token operator">&lt;</span>Spu<span class="token operator">></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="4-4-5-Category中拓展查询名称的功能"><a href="#4-4-5-Category中拓展查询名称的功能" class="headerlink" title="4.4.5.Category中拓展查询名称的功能"></a>4.4.5.Category中拓展查询名称的功能</h3><p>页面需要商品的分类名称需要在这里查询，因此要额外提供查询分类名称的功能，</p>
<p>在CategoryService中添加功能：</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> List<span class="token operator">&lt;</span>String<span class="token operator">></span> <span class="token function">queryNameByIds</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span>Long<span class="token operator">></span> ids<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>categoryMapper<span class="token punctuation">.</span><span class="token function">selectByIdList</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>Category<span class="token operator">:</span><span class="token operator">:</span>getName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>mapper的selectByIDList方法是来自于通用mapper。不过需要我们在mapper上继承一个通用mapper接口：</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CategoryMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token operator">&lt;</span>Category<span class="token operator">></span><span class="token punctuation">,</span> SelectByIdListMapper<span class="token operator">&lt;</span>Category<span class="token punctuation">,</span> Long<span class="token operator">></span> <span class="token punctuation">{</span> 
    <span class="token comment" spellcheck="true">// ...coding</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="4-5-测试"><a href="#4-5-测试" class="headerlink" title="4.5.测试"></a>4.5.测试</h2><p>刷新页面，查看效果：</p>
<p> <img src="/2018/11/12/ly10/1526280777975.png" alt="1526280777975"></p>
<p>基本与预览的效果一致，OK！</p>
<h1 id="5-商品新增"><a href="#5-商品新增" class="headerlink" title="5.商品新增"></a>5.商品新增</h1><h2 id="5-1-效果预览"><a href="#5-1-效果预览" class="headerlink" title="5.1.效果预览"></a>5.1.效果预览</h2><p>新增商品窗口：</p>
<p> <img src="/2018/11/12/ly10/../../../%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E/%E7%AC%94%E8%AE%B0/day08/1526268739827.png" alt="1526268739827"></p>
<p>这个表单比较复杂，因为商品的信息比较多，分成了4个部分来填写：</p>
<ul>
<li>基本信息</li>
<li>商品描述信息</li>
<li>规格参数信息</li>
<li>SKU信息</li>
</ul>
<h2 id="5-2-从0开始"><a href="#5-2-从0开始" class="headerlink" title="5.2.从0开始"></a>5.2.从0开始</h2><p>我们刚刚在查询时，已经实现创建了MyGoodsForm.vue，并且已经在MyGoods中引入。</p>
<p>不过目前没有写代码：</p>
<pre class=" language-vue"><code class="language-vue"><template>
  <v-card>
    my goods form
  </v-card>
</template>

<script>
  export default {
    name: "my-goods-form",
    props: {
      oldGoods: {
        type: Object
      },
      isEdit: {
        type: Boolean,
        default: false
      }
    },
    data() {
      return {

      }
    },
    methods: {
    }
  }
</script>

<style scoped>

</style>

</code></pre>
<p>然后在MyBrand中，已经引入了MyGoodsForm组件，并且页面中也形成了对话框：</p>
<pre class=" language-js"><code class="language-js">  <span class="token comment" spellcheck="true">// 导入自定义的表单组件</span>
  <span class="token keyword">import</span> MyGoodsForm <span class="token keyword">from</span> <span class="token string">'./MyGoodsForm'</span>
</code></pre>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-dialog</span> <span class="token attr-name">max-width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>500<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>show<span class="token punctuation">"</span></span> <span class="token attr-name">persistent</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-card</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!--对话框的标题--></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-toolbar</span> <span class="token attr-name">dense</span> <span class="token attr-name">dark</span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-toolbar-title</span><span class="token punctuation">></span></span>{{isEdit ? '修改' : '新增'}}商品<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-toolbar-title</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-spacer</span><span class="token punctuation">/></span></span>
            <span class="token comment" spellcheck="true">&lt;!--关闭窗口的按钮--></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-btn</span> <span class="token attr-name">icon</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>closeWindow<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-icon</span><span class="token punctuation">></span></span>close<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-icon</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-btn</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-toolbar</span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!--对话框的内容，表单--></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-card-text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>px-5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-goods-form</span> <span class="token attr-name">:oldGoods</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>oldGoods<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-card-text</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-card</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-dialog</span><span class="token punctuation">></span></span>
</code></pre>
<p>并且也已经给新增按钮绑定了点击事件：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-btn</span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>addGoods<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>新增商品<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-btn</span><span class="token punctuation">></span></span>
</code></pre>
<p>addGoods方法中，设置对话框的show属性为true：</p>
<pre class=" language-js"><code class="language-js"><span class="token function">addGoods</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 修改标记</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>isEdit <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 控制弹窗可见：</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>show <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 把oldBrand变为null</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>oldBrand <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>不过弹窗中没有任何数据：</p>
<p> <img src="/2018/11/12/ly10/1526281134046.png" alt="1526281134046"></p>
<h2 id="5-3-新增商品页的基本框架"><a href="#5-3-新增商品页的基本框架" class="headerlink" title="5.3.新增商品页的基本框架"></a>5.3.新增商品页的基本框架</h2><h3 id="5-3-1-Steppers，步骤线"><a href="#5-3-1-Steppers，步骤线" class="headerlink" title="5.3.1.Steppers，步骤线"></a>5.3.1.Steppers，步骤线</h3><p>预览效果图中，分四个步骤显示商品表单的组件，叫做stepper，看下文档：</p>
<p><img src="/2018/11/12/ly10/1526281659782.png" alt="1526281659782"></p>
<p>其基本结构如图：</p>
<p><img src="/2018/11/12/ly10/1526282309386.png" alt="1526282309386"></p>
<p>一个步骤线（v-stepper）总的分为两部分：</p>
<ul>
<li>v-stepper-header：代表步骤的头部进度条，只能有一个<ul>
<li>v-stepper-step：代表进度条的每一个步骤，可以有多个</li>
</ul>
</li>
<li>v-stepper-items：代表当前步骤下的内容组，只能有一个，内部有stepper-content<ul>
<li>v-stepper-content：代表每一步骤的页面内容，可以有多个</li>
</ul>
</li>
</ul>
<blockquote>
<p>v-stepper</p>
</blockquote>
<ul>
<li>value：其值是当前所在的步骤索引，可以用来控制步骤切换</li>
<li>dark：是否使用黑暗色调，默认false</li>
<li>non-linear：是否启用非线性步骤，用户不用按顺序切换，而是可以调到任意步骤，默认false</li>
<li>vertical：是否垂直显示步骤线，默认是false，即水平显示</li>
</ul>
<blockquote>
<p>v-stepper-header的属性：</p>
</blockquote>
<ul>
<li>无</li>
</ul>
<blockquote>
<p>v-stepper-step的属性</p>
</blockquote>
<ul>
<li>color：颜色</li>
<li>complete：当前步骤是否已经完成，布尔值</li>
<li>editable：是否可编辑任意步骤（非线性步骤）</li>
<li>step：步骤索引</li>
</ul>
<blockquote>
<p>v-stepper-items</p>
</blockquote>
<ul>
<li>无</li>
</ul>
<blockquote>
<p>v-stepper-content</p>
</blockquote>
<ul>
<li>step：步骤索引，需要与v-stepper-step中的对应</li>
</ul>
<h3 id="5-3-2-编写页面"><a href="#5-3-2-编写页面" class="headerlink" title="5.3.2.编写页面"></a>5.3.2.编写页面</h3><p>首先我们在data中定义一个变量，记录当前的步骤数：</p>
<pre class=" language-js"><code class="language-js"><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        step<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 当前的步骤数，默认为1</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
<p>然后在模板页面中引入步骤线：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-stepper</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>step<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-stepper-header</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-stepper-step</span> <span class="token attr-name">:complete</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>step <span class="token punctuation">></span> 1<span class="token punctuation">"</span></span> <span class="token attr-name">step</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>基本信息<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-stepper-step</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-divider</span><span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-stepper-step</span> <span class="token attr-name">:complete</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>step <span class="token punctuation">></span> 2<span class="token punctuation">"</span></span> <span class="token attr-name">step</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>商品描述<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-stepper-step</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-divider</span><span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-stepper-step</span> <span class="token attr-name">:complete</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>step <span class="token punctuation">></span> 3<span class="token punctuation">"</span></span> <span class="token attr-name">step</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>规格参数<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-stepper-step</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-divider</span><span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-stepper-step</span> <span class="token attr-name">step</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>4<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>SKU属性<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-stepper-step</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-stepper-header</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-stepper-items</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-stepper-content</span> <span class="token attr-name">step</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        基本信息
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-stepper-content</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-stepper-content</span> <span class="token attr-name">step</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        商品描述
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-stepper-content</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-stepper-content</span> <span class="token attr-name">step</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        规格参数
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-stepper-content</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-stepper-content</span> <span class="token attr-name">step</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>4<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        SKU属性
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-stepper-content</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-stepper-items</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-stepper</span><span class="token punctuation">></span></span>
</code></pre>
<p>效果：</p>
<p><img src="/2018/11/12/ly10/1526283729193.png" alt="1526283729193"></p>
<p>步骤线出现了！</p>
<p>那么问题来了：该如何让这几个步骤切换呢？</p>
<h3 id="5-3-3-步骤切换按钮"><a href="#5-3-3-步骤切换按钮" class="headerlink" title="5.3.3.步骤切换按钮"></a>5.3.3.步骤切换按钮</h3><h4 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h4><p>如果改变step的值与指定的步骤索引一致，就可以实现步骤切换了：</p>
<p><img src="/2018/11/12/ly10/1526283971416.png" alt="1526283971416"></p>
<p>因此，我们需要定义两个按钮，点击后修改step的值，让步骤前进或后退。</p>
<p>那么这两个按钮放哪里？</p>
<p>如果放在MyGoodsForm内，当表单内容过多时，按钮会被挤压到屏幕最下方，不够友好。最好是能够悬停状态。</p>
<p>所以，按钮必须放到MyGoods组件中，也就是父组件。</p>
<p>父组件的对话框是一个card，card组件提供了一个滚动效果，scrollable，如果为true，card的内容滚动时，其头部和底部是可以静止的。</p>
<p>现在card的头部是弹框的标题，card的中间就是表单内容。如果我们把按钮放到底部，就可以实现悬停效果。</p>
<h4 id="页面添加按钮"><a href="#页面添加按钮" class="headerlink" title="页面添加按钮"></a>页面添加按钮</h4><p>改造MyGoods的对话框组件：</p>
<p>  <img src="/2018/11/12/ly10/1526285123845.png" alt="1526285123845"></p>
<p>查看页面：</p>
<p><img src="/2018/11/12/ly10/1526285086042.png" alt="1526285086042"></p>
<h4 id="添加点击事件"><a href="#添加点击事件" class="headerlink" title="添加点击事件"></a>添加点击事件</h4><p>现在这两个按钮点击后没有任何反应。我们需要给他们绑定点击事件，来修改MyGoodsForm中的step的值。</p>
<p>也就是说，父组件要修改子组件的属性状态。想到什么了？</p>
<p>props属性。</p>
<p>我们先在父组件定义一个step属性：</p>
<p> <img src="/2018/11/12/ly10/1526285364638.png" alt="1526285364638"></p>
<p>然后在点击事件中修改它：</p>
<pre class=" language-js"><code class="language-js"><span class="token function">previous</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>step <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>step<span class="token operator">--</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>step <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>step<span class="token operator">++</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>页面绑定事件：</p>
<pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!--底部按钮，用来操作步骤线--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-card-actions</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>elevation-10<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-flex</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>xs3 mx-auto<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-btn</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>previous<span class="token punctuation">"</span></span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">:disabled</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>step <span class="token punctuation">=</span><span class="token punctuation">=</span><span class="token punctuation">=</span> 1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>上一步<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-btn</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-btn</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>next<span class="token punctuation">"</span></span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">:disabled</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>step <span class="token punctuation">=</span><span class="token punctuation">=</span><span class="token punctuation">=</span> 4<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>下一步<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-btn</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-flex</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-card-actions</span><span class="token punctuation">></span></span>
</code></pre>
<p>然后把step属性传递给子组件：</p>
<pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!--对话框的内容，表单--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-card-text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>px-3<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">600</span>px</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-goods-form</span> <span class="token attr-name">:oldGoods</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>oldGoods<span class="token punctuation">"</span></span> <span class="token attr-name">:step</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>step<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-card-text</span><span class="token punctuation">></span></span>
</code></pre>
<p>子组件中接收属性：</p>
<p> <img src="/2018/11/12/ly10/1526285994382.png" alt="1526285994382"></p>
<p>测试效果：</p>
<p> <img src="/2018/11/12/ly10/10.gif" alt=""></p>
<h2 id="5-4-商品基本信息"><a href="#5-4-商品基本信息" class="headerlink" title="5.4.商品基本信息"></a>5.4.商品基本信息</h2><p>商品基本信息，主要是一些纯文本比较简单的SPU属性，例如：</p>
<p>商品分类、商品品牌、商品标题、商品卖点（子标题），包装清单，售后服务</p>
<p>接下来，我们一一添加这些表单项。</p>
<p>注：这里为了简化，我们就不进行form表单校验了。之前已经讲过。</p>
<h3 id="5-4-1-在data中定义Goods属性"><a href="#5-4-1-在data中定义Goods属性" class="headerlink" title="5.4.1.在data中定义Goods属性"></a>5.4.1.在data中定义Goods属性</h3><p>首先，我们需要定义一个goods对象，包括商品的上述属性。</p>
<pre class=" language-js"><code class="language-js"><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        goods<span class="token punctuation">:</span><span class="token punctuation">{</span>
            categories<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 商品3级分类数组信息</span>
            brandId<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">// 品牌id信息</span>
            title<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">// 标题</span>
            subTitle<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">// 子标题</span>
            spuDetail<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                packingList<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">// 包装列表</span>
                afterService<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">// 售后服务</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>注意，这里我们在goods中定义了spuDetail属性，然后把包装列表和售后服务作为它的属性，这样符合数据库的结构。</p>
<h3 id="5-4-2-商品分类选框"><a href="#5-4-2-商品分类选框" class="headerlink" title="5.4.2.商品分类选框"></a>5.4.2.商品分类选框</h3><p>商品分类选框之前我们已经做过了。是级联选框。直接拿来用：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-cascader</span>
        <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/item/category/list<span class="token punctuation">"</span></span>
        <span class="token attr-name">required</span>
        <span class="token attr-name">showAllLevels</span>
        <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>goods.categories<span class="token punctuation">"</span></span>
        <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>请选择商品分类<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
</code></pre>
<p>跟以前使用有一些区别：</p>
<ul>
<li>一个商品只能有一个分类，所以这里去掉了multiple属性</li>
<li>商品SPU中要保存3级商品分类，因此我们这里需要选择showAllLevels属性，显示所有3级分类</li>
</ul>
<p>效果：</p>
<p> <img src="/2018/11/12/ly10/1526290196168.png" alt="1526290196168"></p>
<p>查看goods的属性，三级类目都在：</p>
<p> <img src="/2018/11/12/ly10/1526290263252.png" alt="1526290263252"></p>
<h3 id="5-4-3-品牌选择"><a href="#5-4-3-品牌选择" class="headerlink" title="5.4.3.品牌选择"></a>5.4.3.品牌选择</h3><h4 id="select组件"><a href="#select组件" class="headerlink" title="select组件"></a>select组件</h4><p>品牌不分级别，使用普通下拉选框即可。我们查看官方文档的下拉选框说明：</p>
<p> <img src="/2018/11/12/ly10/1526287929674.png" alt="1526287929674"></p>
<p>组件名：v-select</p>
<p>比较重要的一些属性：</p>
<ul>
<li>item-text：选项中用来展示的字段名，默认是text</li>
<li>item-value：选项中用来作为value值的字段名，默认是value</li>
<li>items：待选项的对象数组</li>
<li>label：提示文本</li>
<li>multiple：是否支持多选，默认是false</li>
</ul>
<p>其它次要属性：</p>
<ul>
<li>autocomplete：是否根据用户输入的文本进行搜索过滤（自动），默认false</li>
<li>chips：是否以小纸片方式显示用户选中的项，默认false</li>
<li>clearable：是否添加清空选项图标，默认是false</li>
<li>color：颜色</li>
<li>dense：是否压缩选择框高度，默认false</li>
<li>editable：是否可编辑，默认false</li>
<li>hide-details：是否隐藏错误提示，默认false</li>
<li>hide-selected：是否在菜单中隐藏已选择的项</li>
<li>hint：提示文本</li>
<li>其它基本与<code>v-text-filed</code>组件类似，不再一一列举</li>
</ul>
<h4 id="页面实现"><a href="#页面实现" class="headerlink" title="页面实现"></a>页面实现</h4><p>备选项items需要我们去后台查询，而且必须是在用户选择商品分类后去查询。</p>
<p>我们定义一个属性，保存品牌的待选项信息：</p>
<p> <img src="/2018/11/12/ly10/1526289926110.png" alt="1526289926110"></p>
<p>然后编写一个watch，监控goods.categories的变化：</p>
<pre class=" language-js"><code class="language-js">watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'goods.categories'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        deep<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token function">handler</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 判断商品分类是否存在，存在才查询</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">&amp;&amp;</span> val<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// 根据分类查询品牌</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/item/brand/cid/"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>goods<span class="token punctuation">.</span>categories<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>brandOptions <span class="token operator">=</span> data<span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>我们的品牌对象包含以下字段：id、name、letter、image。显然item-text应该对应name，item-value应该对应id</p>
<p>因此我们添加一个选框，指定item-text和item-value</p>
<pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!--品牌--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-select</span>
      <span class="token attr-name">:items</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>brandOptions<span class="token punctuation">"</span></span>
      <span class="token attr-name">item-text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span>
      <span class="token attr-name">item-value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span>
      <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>所属品牌<span class="token punctuation">"</span></span>
      <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>goods.brandId<span class="token punctuation">"</span></span>
      <span class="token attr-name">required</span>
      <span class="token attr-name">autocomplete</span>
      <span class="token attr-name">clearable</span>
      <span class="token attr-name">dense</span> <span class="token attr-name">chips</span>
      <span class="token punctuation">/></span></span>
</code></pre>
<h4 id="后台提供接口"><a href="#后台提供接口" class="headerlink" title="后台提供接口"></a>后台提供接口</h4><p>页面需要去后台查询品牌信息，我们自然需要提供：</p>
<blockquote>
<p>controller</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
  * 根据分类查询品牌
  * @param cid
  * @return
  */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"cid/{cid}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> ResponseEntity<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Brand<span class="token operator">>></span> <span class="token function">queryBrandByCategory</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"cid"</span><span class="token punctuation">)</span> Long cid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    List<span class="token operator">&lt;</span>Brand<span class="token operator">></span> list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>brandService<span class="token punctuation">.</span><span class="token function">queryBrandByCategory</span><span class="token punctuation">(</span>cid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>list <span class="token operator">==</span> null<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">ResponseEntity</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>HttpStatus<span class="token punctuation">.</span>NOT_FOUND<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> ResponseEntity<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p>service</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> List<span class="token operator">&lt;</span>Brand<span class="token operator">></span> <span class="token function">queryBrandByCategory</span><span class="token punctuation">(</span>Long cid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>brandMapper<span class="token punctuation">.</span><span class="token function">queryByCategoryId</span><span class="token punctuation">(</span>cid<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p>mapper</p>
</blockquote>
<p>根据分类查询品牌有中间表，需要自己编写Sql：</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"SELECT b.* FROM tb_brand b LEFT JOIN tb_category_brand cb ON b.id = cb.brand_id WHERE cb.category_id = #{cid}"</span><span class="token punctuation">)</span>
List<span class="token operator">&lt;</span>Brand<span class="token operator">></span> <span class="token function">queryByCategoryId</span><span class="token punctuation">(</span>Long cid<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h4 id="测试效果"><a href="#测试效果" class="headerlink" title="测试效果"></a>测试效果</h4><p> <img src="/2018/11/12/ly10/1526290461916.png" alt="1526290461916"></p>
<h3 id="5-4-4-标题等其它字段"><a href="#5-4-4-标题等其它字段" class="headerlink" title="5.4.4.标题等其它字段"></a>5.4.4.标题等其它字段</h3><p>标题等字段都是普通文本，直接使用<code>v-text-field</code>即可：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-text-field</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>商品标题<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>goods.title<span class="token punctuation">"</span></span> <span class="token attr-name">:counter</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>200<span class="token punctuation">"</span></span> <span class="token attr-name">required</span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-text-field</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>商品卖点<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>goods.subTitle<span class="token punctuation">"</span></span> <span class="token attr-name">:counter</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>200<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-text-field</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>包装清单<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>goods.spuDetail.packingList<span class="token punctuation">"</span></span> <span class="token attr-name">:counter</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1000<span class="token punctuation">"</span></span> <span class="token attr-name">multi-line</span> <span class="token attr-name">:rows</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-text-field</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>售后服务<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>goods.spuDetail.afterService<span class="token punctuation">"</span></span> <span class="token attr-name">:counter</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1000<span class="token punctuation">"</span></span> <span class="token attr-name">multi-line</span> <span class="token attr-name">:rows</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
</code></pre>
<p>一些新的属性：</p>
<ul>
<li>counter：计数器，记录当前用户输入的文本字数</li>
<li>rows：文本域的行数</li>
<li>multi-line：把单行文本变成文本域</li>
</ul>
<p><img src="/2018/11/12/ly10/1526290761721.png" alt="1526290761721"></p>
<h2 id="5-5-商品描述信息"><a href="#5-5-商品描述信息" class="headerlink" title="5.5.商品描述信息"></a>5.5.商品描述信息</h2><p>商品描述信息比较复杂，而且图文并茂，甚至包括视频。</p>
<p>这样的内容，一般都会使用富文本编辑器。</p>
<h3 id="5-5-1-什么是富文本编辑器"><a href="#5-5-1-什么是富文本编辑器" class="headerlink" title="5.5.1.什么是富文本编辑器"></a>5.5.1.什么是富文本编辑器</h3><p>百度百科：</p>
<p><img src="/2018/11/12/ly10/1526290914491.png" alt="1526290914491"></p>
<p>通俗来说：富文本，就是比较丰富的文本编辑器。普通的框只能输入文字，而富文本还能给文字加颜色样式等。</p>
<p>富文本编辑器有很多，例如：KindEditor、Ueditor。但并不原生支持vue</p>
<p>但是我们今天要说的，是一款支持Vue的富文本编辑器：<code>vue-quill-editor</code></p>
<h3 id="5-5-2-Vue-Quill-Editor"><a href="#5-5-2-Vue-Quill-Editor" class="headerlink" title="5.5.2.Vue-Quill-Editor"></a>5.5.2.Vue-Quill-Editor</h3><p>GitHub的主页：<a href="https://github.com/surmon-china/vue-quill-editor" target="_blank" rel="noopener">https://github.com/surmon-china/vue-quill-editor</a></p>
<p>Vue-Quill-Editor是一个基于Quill的富文本编辑器：<a href="https://quilljs.com/" target="_blank" rel="noopener">Quill的官网</a></p>
<p><img src="/2018/11/12/ly10/1526291232678.png" alt="1526291232678"></p>
<h3 id="5-5-3-使用指南"><a href="#5-5-3-使用指南" class="headerlink" title="5.5.3.使用指南"></a>5.5.3.使用指南</h3><p>使用非常简单：</p>
<p>第一步：安装，使用npm命令：</p>
<pre><code>npm install vue-quill-editor --save
</code></pre><p>第二步：加载，在js中引入：</p>
<p>全局使用：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> VueQuillEditor <span class="token keyword">from</span> <span class="token string">'vue-quill-editor'</span>

<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* { default global options } */</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueQuillEditor<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// options可选</span>
</code></pre>
<p>局部使用：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token string">'quill/dist/quill.core.css'</span>
<span class="token keyword">import</span> <span class="token string">'quill/dist/quill.snow.css'</span>
<span class="token keyword">import</span> <span class="token string">'quill/dist/quill.bubble.css'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>quillEditor<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue-quill-editor'</span>

<span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    components<span class="token punctuation">:</span><span class="token punctuation">{</span>
        quillEditor
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>第三步：页面引用：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>quill-editor</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>goods.spuDetail.description<span class="token punctuation">"</span></span> <span class="token attr-name">:options</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>editorOption<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
</code></pre>
<h3 id="5-5-4-自定义的富文本编辑器"><a href="#5-5-4-自定义的富文本编辑器" class="headerlink" title="5.5.4.自定义的富文本编辑器"></a>5.5.4.自定义的富文本编辑器</h3><p>不过这个组件有个小问题，就是图片上传的无法直接上传到后台，因此我们对其进行了封装，支持了图片的上传。</p>
<p> <img src="/2018/11/12/ly10/1526296083605.png" alt="1526296083605.png"></p>
<p>使用也非常简单：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-stepper-content</span> <span class="token attr-name">step</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-editor</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>goods.spuDetail.description<span class="token punctuation">"</span></span> <span class="token attr-name">upload-url</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/upload/image<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-stepper-content</span><span class="token punctuation">></span></span>
</code></pre>
<ul>
<li>upload-url：是图片上传的路径</li>
<li>v-model：双向绑定，将富文本编辑器的内容绑定到goods.spuDetail.description</li>
</ul>
<h3 id="5-5-5-效果："><a href="#5-5-5-效果：" class="headerlink" title="5.5.5.效果："></a>5.5.5.效果：</h3><p><img src="/2018/11/12/ly10/1526297276667.png" alt="1526297276667"></p>
<h2 id="5-6-规格参数"><a href="#5-6-规格参数" class="headerlink" title="5.6.规格参数"></a>5.6.规格参数</h2><p>商品规格参数与商品分类绑定，因此我们需要在用户选择商品分类后，去后台查询对应的规格参数模板。</p>
<h3 id="5-6-1-查询商品规格"><a href="#5-6-1-查询商品规格" class="headerlink" title="5.6.1.查询商品规格"></a>5.6.1.查询商品规格</h3><p>首先，我们在data中定义变量，记录查询到的规格参数模板：</p>
<p> <img src="/2018/11/12/ly10/1526297766476.png" alt="1526297766476"></p>
<p>然后，我们通过watch监控goods.categories的变化，然后去查询规格：</p>
<p>  <img src="/2018/11/12/ly10/1526375545366.png" alt="1526375545366"></p>
<p>查看是否查询到：</p>
<p> <img src="/2018/11/12/ly10/1526297980403.png" alt="1526297980403"></p>
<h3 id="5-6-2-页面展示规格属性"><a href="#5-6-2-页面展示规格属性" class="headerlink" title="5.6.2.页面展示规格属性"></a>5.6.2.页面展示规格属性</h3><p>获取到了规格参数，还需要把它展示到页面中。</p>
<p>现在查询到的规格参数只有key，并没有值。值需要用户来根据SPU信息填写，因此规格参数最终需要处理为表单。</p>
<blockquote>
<p>整体结构</p>
</blockquote>
<p>整体来看，规格参数是数组，每个元素是一组规格的集合。我们需要分组来展示。比如每组放到一个card中。</p>
<blockquote>
<p>注意事项：</p>
</blockquote>
<p>规格参数中的属性有一些需要我们特殊处理：</p>
<p> <img src="/2018/11/12/ly10/1526298277201.png" alt="1526298277201"></p>
<ul>
<li>global：是否是全局属性，规格参数中一部分是SPU共享，属于全局属性，另一部是SKU特有，需要根据SKU来填写。因此，在当前版面中，只展示global为true的，即全局属性。sku特有属性放到最后一个面板</li>
<li>numerical：是否是数值类型，如果是，把单位补充在页面表单，不允许用户填写，并且要验证用户输入的数据格式</li>
<li>options：是否有可选项，如果有，则使用下拉选框来渲染。</li>
</ul>
<p>页面代码：</p>
<pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!--3、规格参数--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-stepper-content</span> <span class="token attr-name">step</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-flex</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>xs10 mx-auto px-3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!--遍历整个规格参数，获取每一组--></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-card</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>spec in specifications<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>spec.group<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>my-2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token comment" spellcheck="true">&lt;!--组名称--></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-card-title</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>subheading<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{spec.group}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-card-title</span><span class="token punctuation">></span></span>
            <span class="token comment" spellcheck="true">&lt;!--遍历组中的每个属性，并判断是否是全局属性，不是则不显示--></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-card-text</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>param in spec.params<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>param.k<span class="token punctuation">"</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>param.global<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>px-5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                <span class="token comment" spellcheck="true">&lt;!--判断是否有可选项，如果没有，则显示文本框。还要判断是否是数值类型，如果是把unit显示到后缀--></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-text-field</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>param.options.length &lt;<span class="token punctuation">=</span> 0<span class="token punctuation">"</span></span> 
                              <span class="token attr-name">:label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>param.k<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>param.v<span class="token punctuation">"</span></span> <span class="token attr-name">:suffix</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>param.unit || <span class="token punctuation">'</span><span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
                <span class="token comment" spellcheck="true">&lt;!--否则，显示下拉选项--></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-select</span> <span class="token attr-name">v-else</span> <span class="token attr-name">:label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>param.k<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>param.v<span class="token punctuation">"</span></span> <span class="token attr-name">:items</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>param.options<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-card-text</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-card</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-flex</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-stepper-content</span><span class="token punctuation">></span></span>
</code></pre>
<p>效果：</p>
<p> <img src="/2018/11/12/ly10/1526302470344.png" alt="1526302470344"></p>
<h2 id="5-7-SKU特有属性"><a href="#5-7-SKU特有属性" class="headerlink" title="5.7.SKU特有属性"></a>5.7.SKU特有属性</h2><p>sku特有属性也存在与specifications中，但是我们现在只想展示特有属性，而不是从头遍历一次。因此，我们应该从specifications中把特有规格属性拆分出来独立保存。</p>
<h3 id="5-7-1-筛选特有规格参数"><a href="#5-7-1-筛选特有规格参数" class="headerlink" title="5.7.1.筛选特有规格参数"></a>5.7.1.筛选特有规格参数</h3><p>首先：我们在data中新建一个属性，保存特有的规格参数：</p>
<p> <img src="/2018/11/12/ly10/1526306568822.png" alt="1526306568822"></p>
<p>然后，在查询完成规格模板后，立刻对规格参数进行处理，筛选出特有规格参数，保存到specialSpecs中：</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 根据分类查询规格参数</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/item/spec/"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>goods<span class="token punctuation">.</span>categories<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 保存全部规格</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>specifications <span class="token operator">=</span> data<span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 对特有规格进行筛选</span>
        <span class="token keyword">const</span> temp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span>params<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
            params<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span>k<span class="token punctuation">,</span> options<span class="token punctuation">,</span> global<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>global<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    temp<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        k<span class="token punctuation">,</span> options<span class="token punctuation">,</span>selected<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>specialSpecs <span class="token operator">=</span> temp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>要注意：我们添加了一个selected属性，用于保存用户填写的信息</p>
<p>查看数据：</p>
<p> <img src="/2018/11/12/ly10/1526306826026.png" alt="1526306826026"></p>
<h3 id="5-7-2-页面渲染SKU属性"><a href="#5-7-2-页面渲染SKU属性" class="headerlink" title="5.7.2.页面渲染SKU属性"></a>5.7.2.页面渲染SKU属性</h3><p>接下来，我们把筛选出的特有规格参数，渲染到SKU页面：</p>
<p>我们的目标效果是这样的：</p>
<p> <img src="/2018/11/12/ly10/1526307835157.png" alt="1526307835157"></p>
<p>可以看到，</p>
<ul>
<li>每一个特有属性自成一组，都包含标题和选项。我们可以使用card达到这个效果。</li>
<li>无options选项的特有属性，展示一个文本框，有options选项的，展示多个checkbox，让用户选择</li>
</ul>
<p>页面代码实现：</p>
<pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!--4、SKU属性--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-stepper-content</span> <span class="token attr-name">step</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>4<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-flex</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mx-auto<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token comment" spellcheck="true">&lt;!--遍历特有规格参数--></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-card</span> <span class="token attr-name">flat</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>spec in specialSpecs<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>spec.k<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token comment" spellcheck="true">&lt;!--特有参数的标题--></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-card-title</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>subheading<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{spec.k}}:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-card-title</span><span class="token punctuation">></span></span>
            <span class="token comment" spellcheck="true">&lt;!--特有参数的待选项，需要判断是否有options，如果没有，展示文本框，让用户自己输入--></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-card-text</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>spec.options.length &lt;<span class="token punctuation">=</span> 0<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>px-5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-text-field</span> <span class="token attr-name">:label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">'</span>输入新的<span class="token punctuation">'</span> + spec.k<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>spec.selected<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-card-text</span><span class="token punctuation">></span></span>
            <span class="token comment" spellcheck="true">&lt;!--如果有options，需要展示成多个checkbox--></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-card-text</span> <span class="token attr-name">v-else</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container fluid grid-list-xs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-layout</span> <span class="token attr-name">row</span> <span class="token attr-name">wrap</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>px-5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-checkbox</span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>o in spec.options<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>o<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>flex xs3<span class="token punctuation">"</span></span>
                                <span class="token attr-name">:label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>o<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>spec.selected<span class="token punctuation">"</span></span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>o<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-layout</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-card-text</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-card</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-flex</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-stepper-content</span><span class="token punctuation">></span></span>
</code></pre>
<p>我们的实现效果：</p>
<p><img src="/2018/11/12/ly10/1526308151513.png" alt="1526308151513"></p>
<p>测试下，勾选checkbox或填写文本会发生什么：</p>
<p> <img src="/2018/11/12/ly10/1526308483766.png" alt="1526308483766"></p>
<p>看下规格模板的值：</p>
<p> <img src="/2018/11/12/ly10/1526308513342.png" alt="1526308513342"></p>
<h3 id="5-7-3-自由添加或删除文本框"><a href="#5-7-3-自由添加或删除文本框" class="headerlink" title="5.7.3.自由添加或删除文本框"></a>5.7.3.自由添加或删除文本框</h3><p>刚才的实现中，普通文本项只有一个，如果用户想添加更多值就不行。我们需要让用户能够自由添加新的文本框，而且还能删除。</p>
<p>这里有个取巧的方法：</p>
<p>还记得我们初始化 特有规格参数时，新增了一个selected属性吗，用来保存用户填写的值，是一个数组。每当用户新加一个值，该数组的长度就会加1，而初始长度为0</p>
<p>另外，v-for指令有个特殊之处，就在于它可以遍历数字。比如 v-for=”i in 10”，你会得到1~10</p>
<p>因此，我们可以遍历selected的长度，每当我们输入1个文本，selected长度会加1，自然会多出一个文本框。</p>
<p>代码如下：</p>
<p><img src="/2018/11/12/ly10/1526309463115.png" alt="1526309463115"></p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-card</span> <span class="token attr-name">flat</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>spec in specialSpecs<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>spec.k<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!--特有参数的标题--></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-card-title</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>subheading<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{spec.k}}:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-card-title</span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!--特有参数的待选项，需要判断是否有options，如果没有，展示文本框，让用户自己输入--></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-card-text</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>spec.options.length &lt;<span class="token punctuation">=</span> 0<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>px-5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>i in spec.selected.length+1<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>i<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-text-field</span> <span class="token attr-name">:label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">'</span>输入新的<span class="token punctuation">'</span> + spec.k<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>spec.selected[i-1]<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">v-bind:</span>value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>i<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-card-text</span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!--如果有options，需要展示成多个checkbox--></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-card-text</span> <span class="token attr-name">v-else</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container fluid grid-list-xs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-layout</span> <span class="token attr-name">row</span> <span class="token attr-name">wrap</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>px-5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-checkbox</span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>o in spec.options<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>o<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>flex xs3<span class="token punctuation">"</span></span>
                        <span class="token attr-name">:label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>o<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>spec.selected<span class="token punctuation">"</span></span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>o<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-layout</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-card-text</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-card</span><span class="token punctuation">></span></span>
</code></pre>
<p>效果：</p>
<p> <img src="/2018/11/12/ly10/11.gif" alt=""></p>
<p>而删除文本框相对就比较简单了，只要在文本框末尾添加一个按钮，添加点击事件即可，代码：</p>
<p> <img src="/2018/11/12/ly10/1526310720065.png" alt="1526310720065"></p>
<p>添加了一些布局样式，以及一个按钮，在点击事件中删除一个值。</p>
<h2 id="5-8-展示SKU列表"><a href="#5-8-展示SKU列表" class="headerlink" title="5.8.展示SKU列表"></a>5.8.展示SKU列表</h2><h3 id="5-8-1-效果预览"><a href="#5-8-1-效果预览" class="headerlink" title="5.8.1.效果预览"></a>5.8.1.效果预览</h3><p>当我们选定SKU的特有属性时，就会对应出不同排列组合的SKU。</p>
<p>举例：</p>
<p><img src="/2018/11/12/ly10/1526311110498.png" alt="1526311110498"></p>
<p>当你选择了上图中的这些选项时：</p>
<ul>
<li>颜色共2种：土豪金，绚丽红</li>
<li>内存共2种：2GB，4GB</li>
<li>机身存储1种：64GB</li>
</ul>
<p>此时会产生多少种SKU呢？ 应该是 2 <em> 2 </em> 1 = 4种。</p>
<p>因此，接下来应该由用户来对这4种sku的信息进行详细填写，比如库存和价格等。而多种sku的最佳展示方式，是表格（淘宝、京东都是这么做的），如图：</p>
<p><img src="/2018/11/12/ly10/1526311330409.png" alt="1526311330409"></p>
<p>而且这个表格应该随着用户选择的不同而动态变化。如何实现？</p>
<h3 id="5-8-2-算法：求数组笛卡尔积"><a href="#5-8-2-算法：求数组笛卡尔积" class="headerlink" title="5.8.2.算法：求数组笛卡尔积"></a>5.8.2.算法：求数组笛卡尔积</h3><p>大家看这个结果就能发现，这其实是在求多个数组的笛卡尔积。作为一个程序员，这应该是基本功了吧。</p>
<blockquote>
<p>两个数组笛卡尔积</p>
</blockquote>
<p>假如有两个数组，求笛卡尔积，其基本思路是这样的：</p>
<ul>
<li>在遍历一个数组的同时，遍历另一个数组，然后把元素拼接，放到新数组。</li>
</ul>
<p>示例1：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">,</span><span class="token string">'3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> arr2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

arr1<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>e1 <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    arr2<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>e2 <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>e1 <span class="token operator">+</span> <span class="token string">"_"</span> <span class="token operator">+</span> e2<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>结果：</p>
<p> <img src="/2018/11/12/ly10/1526354069684.png" alt="1526354069684"></p>
<p>完美实现。</p>
<blockquote>
<p>N个数组的笛卡尔积</p>
</blockquote>
<p>如果是N个数组怎么办？</p>
<p>不确定数组数量，代码没有办法写死。该如何处理？</p>
<p>思路：</p>
<ul>
<li>先拿其中两个数组求笛卡尔积</li>
<li>然后把前面运算的结果作为新数组，与第三个数组求笛卡尔积</li>
</ul>
<p>把前两次运算的结果作为第三次运算的参数。大家想到什么了？</p>
<p>没错，之前讲过的一个数组功能：Reduce</p>
<p>reduce函数的声明：</p>
<pre><code>reduce(callback,initvalue)
</code></pre><p>callback：是一个回调函数。这个callback可以接收2个参数：arg1,arg2</p>
<ul>
<li>arg1代表的上次运算得到的结果</li>
<li>arg2是数组中正要处理的元素</li>
</ul>
<p>initvalue，初始化值。第一次调用callback时把initvalue作为第一个参数，把数组的第一个元素作为第二个参数运算。如果未指定，则第一次运算会把数组的前两个元素作为参数。</p>
<p>reduce会把数组中的元素逐个用这个函数处理，然后把结果作为下一次回调函数的第一个参数，数组下个元素作为第二个参数，以此类推。</p>
<p>因此，我们可以把想要求笛卡尔积的多个数组先放到一个大数组中。形成二维数组。然后再来运算：</p>
<p>示例2：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> arr2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 用来作为运算的二维数组</span>
<span class="token keyword">const</span> arr3 <span class="token operator">=</span> <span class="token punctuation">[</span>arr1<span class="token punctuation">,</span> arr2<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> arr3<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>last<span class="token punctuation">,</span> el<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// last：上次运算结果</span>
    <span class="token comment" spellcheck="true">// el：数组中的当前元素</span>
    last<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>e1 <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        el<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>e2 <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
            arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>e1 <span class="token operator">+</span> <span class="token string">"_"</span> <span class="token operator">+</span> e2<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> arr
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>结果：</p>
<p> <img src="/2018/11/12/ly10/1526355132141.png" alt="1526355132141"></p>
<h3 id="5-8-3-算法结合业务"><a href="#5-8-3-算法结合业务" class="headerlink" title="5.8.3.算法结合业务"></a>5.8.3.算法结合业务</h3><p>来看我们的业务逻辑：</p>
<p>首先，我们已经有了一个特有参数的规格模板：</p>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token string">"k"</span><span class="token punctuation">:</span> <span class="token string">"机身颜色"</span><span class="token punctuation">,</span>
    <span class="token string">"selected"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"红色"</span><span class="token punctuation">,</span><span class="token string">"黑色"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token string">"k"</span><span class="token punctuation">:</span> <span class="token string">"内存"</span><span class="token punctuation">,</span>
    <span class="token string">"selected"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"8GB"</span><span class="token punctuation">,</span><span class="token string">"6GB"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token string">"k"</span><span class="token punctuation">:</span> <span class="token string">"机身存储"</span><span class="token punctuation">,</span>
    <span class="token string">"selected"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"64GB"</span><span class="token punctuation">,</span><span class="token string">"256GB"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre>
<p>可以看做是一个二维数组。</p>
<p>一维是参数对象。</p>
<p>二维是参数中的selected选项。</p>
<p>我们想要的结果：</p>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token string">"机身颜色"</span><span class="token punctuation">:</span><span class="token string">"红色"</span><span class="token punctuation">,</span><span class="token string">"内存"</span><span class="token punctuation">:</span><span class="token string">"6GB"</span><span class="token punctuation">,</span><span class="token string">"机身存储"</span><span class="token punctuation">:</span><span class="token string">"64GB"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">"机身颜色"</span><span class="token punctuation">:</span><span class="token string">"红色"</span><span class="token punctuation">,</span><span class="token string">"内存"</span><span class="token punctuation">:</span><span class="token string">"6GB"</span><span class="token punctuation">,</span><span class="token string">"机身存储"</span><span class="token punctuation">:</span><span class="token string">"256GB"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">"机身颜色"</span><span class="token punctuation">:</span><span class="token string">"红色"</span><span class="token punctuation">,</span><span class="token string">"内存"</span><span class="token punctuation">:</span><span class="token string">"8GB"</span><span class="token punctuation">,</span><span class="token string">"机身存储"</span><span class="token punctuation">:</span><span class="token string">"64GB"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">"机身颜色"</span><span class="token punctuation">:</span><span class="token string">"红色"</span><span class="token punctuation">,</span><span class="token string">"内存"</span><span class="token punctuation">:</span><span class="token string">"8GB"</span><span class="token punctuation">,</span><span class="token string">"机身存储"</span><span class="token punctuation">:</span><span class="token string">"256GB"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">"机身颜色"</span><span class="token punctuation">:</span><span class="token string">"黑色"</span><span class="token punctuation">,</span><span class="token string">"内存"</span><span class="token punctuation">:</span><span class="token string">"6GB"</span><span class="token punctuation">,</span><span class="token string">"机身存储"</span><span class="token punctuation">:</span><span class="token string">"64GB"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">"机身颜色"</span><span class="token punctuation">:</span><span class="token string">"黑色"</span><span class="token punctuation">,</span><span class="token string">"内存"</span><span class="token punctuation">:</span><span class="token string">"6GB"</span><span class="token punctuation">,</span><span class="token string">"机身存储"</span><span class="token punctuation">:</span><span class="token string">"256GB"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">"机身颜色"</span><span class="token punctuation">:</span><span class="token string">"黑色"</span><span class="token punctuation">,</span><span class="token string">"内存"</span><span class="token punctuation">:</span><span class="token string">"8GB"</span><span class="token punctuation">,</span><span class="token string">"机身存储"</span><span class="token punctuation">:</span><span class="token string">"64GB"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">"机身颜色"</span><span class="token punctuation">:</span><span class="token string">"黑色"</span><span class="token punctuation">,</span><span class="token string">"内存"</span><span class="token punctuation">:</span><span class="token string">"8GB"</span><span class="token punctuation">,</span><span class="token string">"机身存储"</span><span class="token punctuation">:</span><span class="token string">"256GB"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre>
<p>思路是这样：</p>
<ul>
<li>我们的启点是一个空的对象数组：<code>[{}]</code>，</li>
<li>然后先与第一个规格求笛卡尔积</li>
<li>然后再把结果与下一个规格求笛卡尔积，依次类推</li>
</ul>
<p>如果：</p>
<p><img src="/2018/11/12/ly10/skus.png" alt="skus."></p>
<p>代码：</p>
<p>我们在Vue中新增一个计算属性，按照上面所讲的逻辑，计算所有规格参数的笛卡尔积</p>
<pre class=" language-js"><code class="language-js">computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">skus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 过滤掉用户没有填写数据的规格参数</span>
        <span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>specialSpecs<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>s <span class="token operator">=</span><span class="token operator">></span> s<span class="token punctuation">.</span>selected<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 通过reduce进行累加笛卡尔积</span>
        <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>last<span class="token punctuation">,</span> spec<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            last<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>o <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
                spec<span class="token punctuation">.</span>selected<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>option <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
                    <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
                    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> o<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    obj<span class="token punctuation">[</span>spec<span class="token punctuation">.</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> option<span class="token punctuation">;</span>
                    result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> result
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>结果：</p>
<p> <img src="/2018/11/12/ly10/1526356312119.png" alt="1526356312119"></p>
<p>优化：这里生成的是SKU的数组。因此只包含SKU的规格参数是不够的。结合数据库知道，还需要有下面的字段：</p>
<ul>
<li>price：价格</li>
<li>stock：库存</li>
<li>enable：是否启用。虽然笛卡尔积对应了9个SKU，但用户不一定会需要所有的组合，用这个字段进行标记。</li>
<li>images：商品的图片</li>
<li>indexes：特有属性的索引拼接得到的字符串</li>
</ul>
<p>我们需要给生成的每个sku对象添加上述字段，代码修改如下：</p>
<pre class=" language-js"><code class="language-js">computed<span class="token punctuation">:</span><span class="token punctuation">{</span>
    <span class="token function">skus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 过滤掉用户没有填写数据的规格参数</span>
        <span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>specialSpecs<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>s <span class="token operator">=</span><span class="token operator">></span> s<span class="token punctuation">.</span>selected<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 通过reduce进行累加笛卡尔积</span>
        <span class="token keyword">return</span>  arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>last<span class="token punctuation">,</span> spec<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            last<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>o <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> spec<span class="token punctuation">.</span>selected<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">const</span> option <span class="token operator">=</span> spec<span class="token punctuation">.</span>selected<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
                    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> o<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    obj<span class="token punctuation">[</span>spec<span class="token punctuation">.</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> option<span class="token punctuation">;</span>
                    <span class="token comment" spellcheck="true">// 拼接当前这个特有属性的索引</span>
                    obj<span class="token punctuation">.</span>indexes <span class="token operator">=</span> <span class="token punctuation">(</span>o<span class="token punctuation">.</span>indexes<span class="token operator">||</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'_'</span><span class="token operator">+</span> i
                    <span class="token keyword">if</span><span class="token punctuation">(</span>index <span class="token operator">===</span> arr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token comment" spellcheck="true">// 如果发现是最后一组，则添加价格、库存等字段</span>
                        Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">{</span> price<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span> stock<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span>enable<span class="token punctuation">:</span><span class="token boolean">false</span><span class="token punctuation">,</span> images<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                        <span class="token comment" spellcheck="true">// 去掉索引字符串开头的下划线</span>
                        obj<span class="token punctuation">.</span>indexes <span class="token operator">=</span> obj<span class="token punctuation">.</span>indexes<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> result
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>查看生成的数据：</p>
<p> <img src="/2018/11/12/ly10/1526363824808.png" alt="1526363824808"></p>
<h3 id="5-8-4-页面展现"><a href="#5-8-4-页面展现" class="headerlink" title="5.8.4.页面展现"></a>5.8.4.页面展现</h3><p>页面展现是一个表格。我们之前已经用过。表格需要以下信息：</p>
<ul>
<li>items：表格内的数据</li>
<li>headers：表头信息</li>
</ul>
<p>刚才我们的计算属性skus得到的就是表格数据了。我们还差头：headers</p>
<p>头部信息也是动态的，用户选择了一个属性，就会多出一个表头。与skus是关联的。</p>
<p>既然如此，我们再次编写一个计算属性，来计算得出header数组：</p>
<pre class=" language-js"><code class="language-js"><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>skus<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> headers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 获取skus中的任意一个，获取key，然后遍历其属性</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>skus<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>k <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> value <span class="token operator">=</span> k<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">===</span> <span class="token string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// enable，表头要翻译成“价格”</span>
            k <span class="token operator">=</span> <span class="token string">'价格'</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">===</span> <span class="token string">'stock'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// enable，表头要翻译成“库存”</span>
            k <span class="token operator">=</span> <span class="token string">'库存'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">===</span> <span class="token string">'enable'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// enable，表头要翻译成“是否启用”</span>
            k <span class="token operator">=</span> <span class="token string">'是否启用'</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">===</span> <span class="token string">'indexes'</span> <span class="token operator">||</span> k <span class="token operator">===</span> <span class="token string">'images'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 图片和索引不在表格中展示</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        headers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            text<span class="token punctuation">:</span> k<span class="token punctuation">,</span>
            align<span class="token punctuation">:</span> <span class="token string">'center'</span><span class="token punctuation">,</span>
            sortable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            value
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> headers<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>接下来编写页面，实现table。</p>
<p>需要注意的是，price、stock字段需要用户填写数值，不能直接展示。enable要展示为checkbox，让用户选择，如图：</p>
<p><img src="/2018/11/12/ly10/1526364758744.png" alt="1526364758744"></p>
<p>代码：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-card</span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!--标题--></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-card-title</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>subheading<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>SKU列表<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-card-title</span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!--SKU表格，hide-actions因此分页等工具条--></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-data-table</span> <span class="token attr-name">:items</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>skus<span class="token punctuation">"</span></span> <span class="token attr-name">:headers</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>headers<span class="token punctuation">"</span></span> <span class="token attr-name">hide-actions</span> <span class="token attr-name">item-key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>indexes<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>items<span class="token punctuation">"</span></span> <span class="token attr-name">slot-scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>props<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token comment" spellcheck="true">&lt;!--价格和库存展示为文本框--></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(v,k) in props.item<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>k<span class="token punctuation">"</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>[<span class="token punctuation">'</span>price<span class="token punctuation">'</span>, <span class="token punctuation">'</span>stock<span class="token punctuation">'</span>].includes(k)<span class="token punctuation">"</span></span>
                <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text-xs-center<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-text-field</span> <span class="token attr-name">single-line</span> <span class="token attr-name">v-model.number</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>props.item[k]<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
            <span class="token comment" spellcheck="true">&lt;!--enable展示为checkbox--></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text-xs-center<span class="token punctuation">"</span></span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>k <span class="token punctuation">=</span><span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token punctuation">'</span>enable<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-checkbox</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>props.item[k]<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
            <span class="token comment" spellcheck="true">&lt;!--indexes和images不展示，其它展示为普通文本--></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text-xs-center<span class="token punctuation">"</span></span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>![<span class="token punctuation">'</span>indexes<span class="token punctuation">'</span>,<span class="token punctuation">'</span>images<span class="token punctuation">'</span>].includes(k)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{v}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-data-table</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-card</span><span class="token punctuation">></span></span>
</code></pre>
<p>效果：</p>
<p><img src="/2018/11/12/ly10/1526365039421.png" alt="1526365039421"></p>
<h3 id="5-8-5-图片上传列表"><a href="#5-8-5-图片上传列表" class="headerlink" title="5.8.5.图片上传列表"></a>5.8.5.图片上传列表</h3><p>这个表格中只展示了基本信息，当用户需要上传图片时，该怎么做呢？</p>
<p>Vuetify的table有一个展开功能，可以提供额外的展示空间：</p>
<p><img src="/2018/11/12/ly10/1526366340741.png" alt="1526366340741"></p>
<p>用法也非常简单，添加一个template，把其slot属性指定为expand即可：</p>
<p><img src="/2018/11/12/ly10/1526366667064.png" alt="1526366667064"></p>
<p>效果：</p>
<p><img src="/2018/11/12/ly10/1526366997943.png" alt="1526366997943"></p>
<p>接下来就是我们的图片上传组件：v-upload</p>
<p><img src="/2018/11/12/ly10/1526367719809.png" alt="1526367719809"></p>
<h2 id="5-9-表单提交"><a href="#5-9-表单提交" class="headerlink" title="5.9.表单提交"></a>5.9.表单提交</h2><h3 id="5-9-1-添加提交按钮"><a href="#5-9-1-添加提交按钮" class="headerlink" title="5.9.1.添加提交按钮"></a>5.9.1.添加提交按钮</h3><p>我们在step=4，也就是SKU属性列表页面， 添加一个提交按钮。</p>
<pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!--提交按钮--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-flex</span> <span class="token attr-name">xs3</span> <span class="token attr-name">offset-xs9</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-btn</span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>保存商品信息<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-btn</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-flex</span><span class="token punctuation">></span></span>
</code></pre>
<p>效果：</p>
<p><img src="/2018/11/12/ly10/1526366187195.png" alt="1526366187195"></p>
<h3 id="5-9-2点击事件"><a href="#5-9-2点击事件" class="headerlink" title="5.9.2点击事件"></a>5.9.2点击事件</h3><p>当用户点击保存，我们就需要对页面的数据进行整理，然后提交到后台服务。</p>
<p>现在我们页面包含了哪些信息呢？我们与数据库对比，看看少什么</p>
<ul>
<li>goods：里面包含了SPU的几乎所有信息<ul>
<li>title：标题</li>
<li>subtitle：子标题，卖点</li>
<li>categories：分类对象数组，需要进行整理 **</li>
<li>brandId：品牌id</li>
<li>spuDetail：商品详情<ul>
<li>packingList：包装清单</li>
<li>afterService：售后服务</li>
<li>description：商品描述</li>
<li>缺少全局规格属性specifications **</li>
<li>缺少特有规格属性模板spec_template **</li>
</ul>
</li>
</ul>
</li>
<li>skus：包含了sku列表的几乎所有信息<ul>
<li>price：价格，需要处理为以分为单位</li>
<li>stock：库存</li>
<li>enable：是否启用</li>
<li>indexes：索引</li>
<li>images：图片，数组，需要处理为字符串**</li>
<li>缺少其它特有规格，ows_spec **</li>
<li>缺少标题：需要根据spu的标题结合特有属性生成 ** </li>
</ul>
</li>
<li>specifications：全局规格参数的键值对信息</li>
<li>specialSpec：特有规格参数信息</li>
</ul>
<p>在页面绑定点击事件：</p>
<pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!--提交按钮--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-flex</span> <span class="token attr-name">xs3</span> <span class="token attr-name">offset-xs9</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>v-btn</span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>保存商品信息<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-btn</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>v-flex</span><span class="token punctuation">></span></span>
</code></pre>
<p>编写代码，整理数据：</p>
<pre class=" language-js"><code class="language-js"><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 表单校验。 略</span>
    <span class="token comment" spellcheck="true">// 先处理goods，用结构表达式接收,除了categories外，都接收到goodsParams中</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>categories<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>id<span class="token punctuation">:</span>cid1<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>id<span class="token punctuation">:</span>cid2<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>id<span class="token punctuation">:</span>cid3<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">...</span>goodsParams<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>goods<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 处理规格参数</span>
    <span class="token keyword">const</span> specs <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>specifications<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span>group<span class="token punctuation">,</span>params<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> newParams <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span>options<span class="token punctuation">,</span><span class="token operator">...</span>rest<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> rest<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>group<span class="token punctuation">,</span>params<span class="token punctuation">:</span>newParams<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 处理特有规格参数模板</span>
    <span class="token keyword">const</span> specTemplate <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>specialSpecs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span>k<span class="token punctuation">,</span> selected<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        specTemplate<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> selected<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 处理sku</span>
    <span class="token keyword">const</span> skus <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>skus<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>s <span class="token operator">=</span><span class="token operator">></span> s<span class="token punctuation">.</span>enable<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span>price<span class="token punctuation">,</span>stock<span class="token punctuation">,</span>enable<span class="token punctuation">,</span>images<span class="token punctuation">,</span>indexes<span class="token punctuation">,</span> <span class="token operator">...</span>rest<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 标题，在spu的title基础上，拼接特有规格属性值</span>
        <span class="token keyword">const</span> title <span class="token operator">=</span> goodsParams<span class="token punctuation">.</span>title <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>rest<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            price<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$format</span><span class="token punctuation">(</span>price<span class="token operator">+</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span>stock<span class="token punctuation">,</span>enable<span class="token punctuation">,</span>indexes<span class="token punctuation">,</span>title<span class="token punctuation">,</span><span class="token comment" spellcheck="true">// 基本属性</span>
            images<span class="token punctuation">:</span> <span class="token operator">!</span>images <span class="token operator">?</span> <span class="token string">''</span> <span class="token punctuation">:</span> images<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 图片</span>
            ownSpec<span class="token punctuation">:</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>rest<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 特有规格参数</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>goodsParams<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        cid1<span class="token punctuation">,</span>cid2<span class="token punctuation">,</span>cid3<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 商品分类</span>
        skus<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// sku列表</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    goodsParams<span class="token punctuation">.</span>spuDetail<span class="token punctuation">.</span>specifications<span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>specs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    goodsParams<span class="token punctuation">.</span>spuDetail<span class="token punctuation">.</span>specTemplate <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>specTemplate<span class="token punctuation">)</span><span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>goodsParams<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>点击测试，看效果：</p>
<p><img src="/2018/11/12/ly10/1526391630336.png" alt="1526391630336"></p>
<p>向后台发起请求，因为请求体复杂，我们直接发起Json请求：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/item/goods"</span><span class="token punctuation">,</span>goodsParams<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 成功，关闭窗口</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 提示成功</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">"新增成功了"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"保存失败！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="5-9-3-后台编写接口"><a href="#5-9-3-后台编写接口" class="headerlink" title="5.9.3.后台编写接口"></a>5.9.3.后台编写接口</h3><h4 id="实体类"><a href="#实体类" class="headerlink" title="实体类"></a>实体类</h4><blockquote>
<p>Spu</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"tb_spu"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Spu</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> GenerationType<span class="token punctuation">.</span>IDENTITY<span class="token punctuation">)</span>
    <span class="token keyword">private</span> Long id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Long brandId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Long cid1<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 1级类目</span>
    <span class="token keyword">private</span> Long cid2<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 2级类目</span>
    <span class="token keyword">private</span> Long cid3<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 3级类目</span>
    <span class="token keyword">private</span> String title<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 标题</span>
    <span class="token keyword">private</span> String subTitle<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 子标题</span>
    <span class="token keyword">private</span> Boolean saleable<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 是否上架</span>
    <span class="token keyword">private</span> Boolean valid<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 是否有效，逻辑删除用</span>
    <span class="token keyword">private</span> Date createTime<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 创建时间</span>
    <span class="token keyword">private</span> Date lastUpdateTime<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 最后修改时间</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p>SpuDetail</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"tb_spu_detail"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpuDetail</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token keyword">private</span> Long spuId<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 对应的SPU的id</span>
    <span class="token keyword">private</span> String description<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 商品描述</span>
    <span class="token keyword">private</span> String specTemplate<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 商品特殊规格的名称及可选值模板</span>
    <span class="token keyword">private</span> String specifications<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 商品的全局规格属性</span>
    <span class="token keyword">private</span> String packingList<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 包装清单</span>
    <span class="token keyword">private</span> String afterService<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 售后服务</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p>Sku</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"tb_sku"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Sku</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> GenerationType<span class="token punctuation">.</span>IDENTITY<span class="token punctuation">)</span>
    <span class="token keyword">private</span> Long id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Long spuId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> String title<span class="token punctuation">;</span>
    <span class="token keyword">private</span> String images<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Long price<span class="token punctuation">;</span>
    <span class="token keyword">private</span> String ownSpec<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 商品特殊规格的键值对</span>
    <span class="token keyword">private</span> String indexes<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 商品特殊规格的下标</span>
    <span class="token keyword">private</span> Boolean enable<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 是否有效，逻辑删除用</span>
    <span class="token keyword">private</span> Date createTime<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 创建时间</span>
    <span class="token keyword">private</span> Date lastUpdateTime<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 最后修改时间</span>
    <span class="token annotation punctuation">@Transient</span>
    <span class="token keyword">private</span> Long stock<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 库存</span>
<span class="token punctuation">}</span>
</code></pre>
<p>注意：这里保存了一个库存字段，在数据库中是另外一张表保存的，方便查询。</p>
<blockquote>
<p>Stock</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"tb_stock"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Stock</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token keyword">private</span> Long skuId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Integer seckillStock<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 秒杀可用库存</span>
    <span class="token keyword">private</span> Integer seckillTotal<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 已秒杀数量</span>
    <span class="token keyword">private</span> Integer stock<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 正常库存</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h4><p>四个问题：</p>
<ul>
<li><p>请求方式：POST</p>
</li>
<li><p>请求路径：/goods</p>
</li>
<li><p>请求参数：Spu的json格式的对象，spu中包含spuDetail和Sku集合。这里我们该怎么接收？我们之前定义了一个SpuBo对象，作为业务对象。这里也可以用它，不过需要再扩展spuDetail和skus字段：</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpuBo</span> <span class="token keyword">extends</span> <span class="token class-name">Spu</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Transient</span>
    String cname<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 商品分类名称</span>
    <span class="token annotation punctuation">@Transient</span>
    String bname<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 品牌名称</span>
    <span class="token annotation punctuation">@Transient</span>
    SpuDetail spuDetail<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 商品详情</span>
    <span class="token annotation punctuation">@Transient</span>
    List<span class="token operator">&lt;</span>Sku<span class="token operator">></span> skus<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// sku列表</span>
<span class="token punctuation">}</span>
</code></pre>
</li>
<li><p>返回类型：无</p>
</li>
</ul>
<p>代码：</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * 新增商品
 * @param spu
 * @return
 */</span>
<span class="token annotation punctuation">@PostMapping</span>
<span class="token keyword">public</span> ResponseEntity<span class="token operator">&lt;</span>Void<span class="token operator">></span> <span class="token function">saveGoods</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> Spu spu<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>goodsService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>spu<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntity</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>HttpStatus<span class="token punctuation">.</span>CREATED<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntity</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>HttpStatus<span class="token punctuation">.</span>INTERNAL_SERVER_ERROR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>注意：通过@RequestBody注解来接收Json请求</p>
<blockquote>
<p>Service</p>
</blockquote>
<p>这里的逻辑比较复杂，我们除了要对SPU新增以外，还要对SpuDetail、Sku、Stock进行保存</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span>SpuBo spu<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 保存spu</span>
    spu<span class="token punctuation">.</span><span class="token function">setSaleable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    spu<span class="token punctuation">.</span><span class="token function">setValid</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    spu<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    spu<span class="token punctuation">.</span><span class="token function">setLastUpdateTime</span><span class="token punctuation">(</span>spu<span class="token punctuation">.</span><span class="token function">getCreateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>spuMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>spu<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 保存spu详情</span>
    spu<span class="token punctuation">.</span><span class="token function">getSpuDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSpuId</span><span class="token punctuation">(</span>spu<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>spuDetailMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>spu<span class="token punctuation">.</span><span class="token function">getSpuDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// 保存sku和库存信息</span>
    <span class="token function">saveSkuAndStock</span><span class="token punctuation">(</span>spu<span class="token punctuation">.</span><span class="token function">getSkus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> spu<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">saveSkuAndStock</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span>Sku<span class="token operator">></span> skus<span class="token punctuation">,</span> Long spuId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>Sku sku <span class="token operator">:</span> skus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sku<span class="token punctuation">.</span><span class="token function">getEnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// 保存sku</span>
        sku<span class="token punctuation">.</span><span class="token function">setSpuId</span><span class="token punctuation">(</span>spuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 默认不参与任何促销</span>
        sku<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sku<span class="token punctuation">.</span><span class="token function">setLastUpdateTime</span><span class="token punctuation">(</span>sku<span class="token punctuation">.</span><span class="token function">getCreateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>skuMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>sku<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 保存库存信息</span>
        Stock stock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Stock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        stock<span class="token punctuation">.</span><span class="token function">setSkuId</span><span class="token punctuation">(</span>sku<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        stock<span class="token punctuation">.</span><span class="token function">setStock</span><span class="token punctuation">(</span>sku<span class="token punctuation">.</span><span class="token function">getStock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>stockMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>stock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="Mapper"><a href="#Mapper" class="headerlink" title="Mapper"></a>Mapper</h4><p>都是通用Mapper，略</p>

            </div>
            <hr>

            
            <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.88rem;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff;
        background-color: #22AB38;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff;
        background-color: #019FE8;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a class="reward-link btn-floating btn-large waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close"><i class="fa fa-close"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs">
                        <li class="tab wechat-tab waves-effect waves-light"><a class="active" href="#wechat">微信</a></li>
                        <li class="tab alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                    </ul>
                    <div id="wechat">
                        <img src="/medias/reward/" class="reward-img" alt="微信打赏二维码">
                    </div>
                    <div id="alipay">
                        <img src="/medias/reward/" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('#reward .reward-link').on('click', function () {
            $('#rewardModal').openModal();
        });

        $('#rewardModal .close').on('click', function () {
            $('#rewardModal').closeModal();
        });
    });
</script>
            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone, qq, weibo, douban"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            <div class="reprint">
                <p>
                    <span class="reprint-tip">转载请注明: </span>
                    <a href="https://geekerstar.github.io" class="b-link-green">极客文库-知识库</a>
                    <i class="fa fa-angle-right fa-lg fa-fw text-color"></i>
                    <a href="/2018/11/12/ly10/" class="b-link-green">电商网站实战第十章：商品规格管理</a>
                </p>
            </div>
        </div>
    </div>

    
        <link rel="stylesheet" href="/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: 'e5af4edd318be4fd1767',
        clientSecret: '5710d909cf183f3dbc6864ad973cdbc2dd3361e6',
        repo: 'geekerstar.github.io',
        owner: 'geekerstar',
        admin: "geekerstar",
        id: '2018-11-12T14-56-47',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>
    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">上一篇</div>
            <div class="card">
                <a href="/2018/11/13/ly11/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/14.jpg" class="responsive-img" alt="电商网站实战第十一章：商品管理">
                        
                        <span class="card-title">电商网站实战第十一章：商品管理</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary">0.学习目标
独立实现商品新增后台
独立实现商品编辑后台
独立搭建前台系统页面

1.商品新增当我们点击新增商品按钮：

就会出现一个弹窗：

里面把商品的数据分为了4部分来填写：

基本信息：主要是一些简单的文本数据，包含了SPU和Spu</div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2018-11-13
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/项目实战/" class="post-category" target="_blank">
                                    项目实战
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/项目实战/" target="_blank">
                        <span class="chip bg-color">项目实战</span>
                    </a>
                    
                    <a href="/tags/微服务/" target="_blank">
                        <span class="chip bg-color">微服务</span>
                    </a>
                    
                    <a href="/tags/电商网站/" target="_blank">
                        <span class="chip bg-color">电商网站</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">下一篇</div>
            <div class="card">
                <a href="/2018/11/11/ly09/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/2.jpg" class="responsive-img" alt="电商网站实战第九章：品牌管理">
                        
                        <span class="card-title">电商网站实战第九章：品牌管理</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary">0.学习目标
独立实现品牌新增
实现图片上传
了解FastDFS的安装
使用FastDFS客户端实现上传

1.品牌的新增昨天我们完成了品牌的查询，接下来就是新增功能。
1.1.页面实现1.1.1.初步编写弹窗当我们点击新增按钮，应该出现一</div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2018-11-11
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/项目实战/" class="post-category" target="_blank">
                                    项目实战
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/项目实战/" target="_blank">
                        <span class="chip bg-color">项目实战</span>
                    </a>
                    
                    <a href="/tags/微服务/" target="_blank">
                        <span class="chip bg-color">微服务</span>
                    </a>
                    
                    <a href="/tags/电商网站/" target="_blank">
                        <span class="chip bg-color">电商网站</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>
    </div>
    <div class="col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title">目录</div>
            <div id="toc-content">

            </div>
        </div>
    </div>
</div>

<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });
    });
</script>
    

</main>


<footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            本站由&copy;<a href="http://www.geekerstar.com" target="_blank">Geekerstar</a>维护，作为
            <a href="https://www.jikewenku.com" target="_blank">极客文库</a>辅助站
        </div>
        <div class="col s12 m4 l4 social-link"><a href="https://github.com/geekerstar" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
    <i class="fa fa-github"></i>
</a>
<a href="https://weibo.com/247507792" class="tooltipped" target="_blank" data-tooltip="微博联系我" data-position="top" data-delay="50">
    <i class="fa fa-weibo"></i>
</a>
<a href="#!" class="tooltipped" data-tooltip="QQ联系我: 247507792" data-position="top" data-delay="50">
    <i class="fa fa-qq"></i>
</a>

<a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
    <i class="fa fa-rss"></i>
</a>
</div>
    </div>
</footer>

<div class="progress-bar"></div>


<!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title">搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input" autofocus>
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
</script>
<!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


<script src="/libs/materialize/js/materialize.min.js"></script>
<script src="/libs/masonry/masonry.pkgd.min.js"></script>
<script src="/libs/aos/aos.js"></script>
<script src="/libs/scrollprogress/scrollProgress.min.js"></script>
<script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
<script src="/js/matery.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->


</body>
</html>